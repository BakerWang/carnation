<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />

    <title>健康资讯</title>
   	<script src="${staticPath}/static/app/assets/js/base64.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		function is_weixin(){
			var ua = navigator.userAgent.toLowerCase();
			if(ua.match(/MicroMessenger/i)=="micromessenger") {
				return true;
		 	} else {
				return false;
			}
		}
		function getUrlPar(name) {
			   var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");
			   var r = window.location.search.substr(1).match(reg);
			   if (r!=null) return (r[2]); return null;
		}
		function wxlogin(){
			if(is_weixin()&&getUrlPar('isflag')==null){
				var url=Base64.encode(location.href);
				var invitationCode=getUrlPar('invitationCode');
				if(parseInt(invitationCode)==NaN) return;				
				location.href="${mobilePath}/user/loginUrl.htm?url='"+url+"'&invitationCode="+invitationCode;
			}
		}
		wxlogin();
		
	</script>
    #parse("/include/common.htm")
    
	    <!-- 公共对话框样式 -->
	<link rel="stylesheet" type="text/css" href="${staticPath}/static/app/assets/widget/dialog/dialog.css?v=1">
	
	<!-- css3弹出动画样式 -->
	<link rel="stylesheet" type="text/css" href="${staticPath}/static/app/assets/widget/dialog/dialog-sandra.css">
	
	<script type="text/javascript" src="${staticPath}/static/app/assets/widget/dialog/modernizr.custom.js"></script>
	<style>
		.bbs-cont img{
		    width: 100% !important;
   			height: auto !important;
		}
		#wrapper{overflow:auto;position: relative;}
		#scroller{position: relative;}
	</style>
</head>
<body>
<!-- 分享人的邀请码 -->
<input  type ="hidden" name ="invitationCode"  value='$!invitationCode'/>
    <div class="wrapper">
        <div id="wrapper" class="no-bot">
            <div id="scroller">
                <!-- <div class="bbs-header">
                    <div class="date">发布于$!invitation.addTimeString</div>
                    <div class="bbs-user-info">
                    	#if($!invitation.circleType == '1')
	                        <img class="pic" src="#if($!{invitation.headImgPath} && $!{invitation.headImgPath} != '') $!{invitation.headImgPath}_80x80 #else http://static.ysysgo.com/static/app/assets/images/default-avatar.jpg #end" />
	                        <div class="info">
	                            <div class="name">$!invitation.userName</div>
	                             <div class="color-pop">楼主</div>
	                        </div>
                        #else
                        	<img class="pic" src="${staticPath}/static/app/assets/images/official.jpg" />
                        	<div class="info">
		                        <div class="name">官方</div>
		                        <div class="color-pop">楼主</div>
	                        </div>
                        #end
                    </div>
                    <i class="icon-triangle-up up-border-arrow"></i>
                </div> -->
				<style>
					.guanzhu{float:right;font-size:12px;width:79px;height:32px;color:#fff;text-align:center;line-height:32px;background:url("${staticPath}/static/app/assets/images/green_btn.png") no-repeat;background-size:79px 32px;}
				</style>
                <div class="bbs-cont">
                    <h3 class="title">
                    <a id="gzgzh" href="javascript:;" class="guanzhu">关注公众号</a>
                    $!invitation.title                    	
                    </h3>
                    <div class="cont">
                        $!invitation.content
                    </div>
                    <div class="cont">
                    #foreach($pic1 in $invitation.picList) 
                    	<a href='javascript:;' data-dialog='$!{pic1}_600x800s'><img src='$!{pic1}_60x80s' /></a>
                     #end
                    </div>
<!--                     <div class="reply">
                    	<span class="fl"><i class="icon-chat"></i> 跟帖($!invitation.replyCount)</span>
                    	<a href="javascript:void(0)" onclick="replyCircle($!invitation.id);"><i class="icon-warning"></i> 举报</a>
                    </div> -->
                </div>
                
                <!-- 显示app下载注册地址 -->
                 <div class="bbs-cont" style="top:-22px;position:relative"> 
                      <div class="info" id="info">
                      		<a href="http://app.ysysgo.com">
                      		  <img class="pic" src="${staticPath}/static/app/assets/images/buttonInfo.jpg" />
                     		</a>
                      </div>
                </div>
                <div style="height:50px"></div>
                <!--  <div class="bbs-cont">                 
                   #if($!jgyes_app == '1')                   		  
                        
                         <div class="info">
	                       <a href="http://shop.ysysgo.com/mobile_register.htm?invitationCode=$!invitationCode">
                        		  <img class="pic" src="${staticPath}/static/app/assets/images/buttonInfo.jpg" />
                       		 </a>
                        </div>
                        #else 
                        	
                        #end
                        
                    #if($!jgyes_app == '2')                 	   
                        
                         <div class="info">
	                       <a href="http://shop.ysysgo.com/mobile_register.htm?invitationCode=$!invitationCode">
                        		  <img class="pic" src="${staticPath}/static/app/assets/images/buttonInfo.jpg" />
                       		 </a>
                        </div>
                        #else 
                        	
                        #end 
                </div> -->
                
               <!--  <ul class="bbs-list list">
                	#foreach($repay in $repayList)
                    <li>
                        <div class="bbs-header">
                            <div class="date text-right">发布于$!repay.addTimeString</div>
                            <div class="bbs-user-info">
                                <img class="pic" src="#if($!{repay.userPhoto} && $!{repay.userPhoto} != '') $!{repay.userPhoto}_80x80 #else http://static.ysysgo.com/static/app/assets/images/default-avatar.jpg #end" />
                                <div class="name">
                                    $!repay.userName
                                </div>
                            </div>
                            <i class="icon-triangle-up up-border-arrow"></i>
                        </div>
                        <div class="bbs-reply-cont">
                        	#if($repay.parentId)
                            <div class="reply-quotes">
                                <div class="title">回复 $!{repay.parentName}</div>
                                $!{repay.parentContent} 
                                #if($repay.parentPicList)
	                            <div>
	                            	#foreach($pic in $repay.parentPicList) 
	                               		<a href='javascript:;' data-dialog='$!{pic}_600x800s'><img src='$!{pic}_60x80s' /></a>
	                               	#end
	                            </div>
	                            #end
                            </div>
                            
                            #end
                            $!repay.content 
                            </br> 
                            
                         	#foreach($pic in $repay.picList)
                            	<a href='javascript:;' data-dialog='$!{pic}_600x800s'><img src='$!{pic}_60x80s' /></a>
                            #end
                            <div class="pt-10 text-right"><button class="bbs-reply-Btn" onclick="repayComment($!invitation.id, $repay.id);">回复</button></div>
                        </div>
                    </li>
                    #end
                </ul> -->
				<div id="pullUp" class="ub ub-pc c-gra">
				</div>
<!--                 <div id="pullUp" class="ub ub-pc c-gra">
                    <div class="pullUpIcon"></div>
                    <div class="pullUpLabel">上拉显示更多...</div>
                </div> -->
                
                

        </div></div>
    </div>
   
    
    
    <div id="somedialog" class="dialog" style="z-index:1;">
		<div class="dialog__overlay"></div>
		<div class="dialog__content"></div>
		<div style="display:none;"><button class="action" data-dialog-close="">Close</button></div>
	</div>
    <style>
        .float_bottom{position: fixed;left:0; bottom:0;width: 100%;max-width: 750px;z-index:1000;}
        .float_bottom img{width: 100%;vertical-align: middle;display:block}
        .float_bottom a.download{width: 100%;display:block;}
    </style>
    
    <div class="float_bottom">
        <a href="http://app.ysysgo.com" class="download" >
      	  <img src="${staticPath}/static/app/assets/images/float.png">
		</a>
    </div>
    <script src="${staticPath}/static/app/assets/js/gongzhonghao.js"></script>
  <!--    #if($!jgyes_app == '2')
     	  <div class="float_bottom">
		        
		        <a href="#" class="close">关闭</a>
		        <a href="http://shop.ysysgo.com/mobile_register.htm?invitationCode=$!invitationCode" class="download">
		      	  <img src="${staticPath}/static/app/assets/images/float_bottom.png">
				</a>
		    </div>
        #end
             
             
        #if($!jgyes_app == '1')
			  <div class="float_bottom">
		        
		        <a href="#" class="close">关闭</a>
		        <a href="http://shop.ysysgo.com/mobile_register.htm?invitationCode=$!invitationCode" class="download">
		      	  <img src="${staticPath}/static/app/assets/images/float_bottom.png">
				</a>
		    </div>
		   #else 
		   	
		   #end
		    -->
   

    <script src="${staticPath}/static/app/assets/js/jquery-2.1.4.min.js"></script>
    <script src="${staticPath}/static/app/assets/widget/iscroll-probe.js"></script>
    
    <input type="hidden" value="$!repayList.size()" id="start"/>
    <input type="hidden" value="$!maxId" id="maxId"/>
    <input type="hidden" value="$!vo.invitationId" id="invitationId"/>
<script>
    var myScroll;
    var pullDownEl, pullDownL;
    var pullUpEl, pullUpL;
    var Downcount = 0 ,Upcount = 0;
    var loadingStep = 0;//加载状态0默认，1显示加载状态，2执行加载数据，只有当为0时才能再次加载，这是防止过快拉动刷新
    function pullUpAction() {//上拉事件
        setTimeout(function() {
            var el, li, i, html;
            html='';
            jQuery.ajax({
                type: "GET",
                url: "${apiPath}/circle/ajax_invitation_repay",
                data: {invitationId:$("#invitationId").val(), start:$("#start").val(), maxId:$("#maxId").val()},
                dataType: "json",
                success: function(data){
                	if(data != 'no')
                	{
                	   var jsonArray = eval(data);
                	   jQuery.each(jsonArray, function(i, item){     
	                	   html += '<div class="bbs-header">\
	                           <div class="date text-right">发布于'+item.addTimeString+' </div>\
	                           <div class="bbs-user-info">\
	                                   <img class="pic" src="'+(function() { if (item.userPhoto) {return item.userPhoto +'_80x80' } else { return "http://static.ysysgo.com/static/app/assets/images/default-avatar.jpg" } }()) + '" />\
	                                   <div class="name">'+(item.userName || "")+'</div>\
	                           </div>\
	                           <i class="icon-triangle-up up-border-arrow"></i>\
	                           </div>\
	                           <div class="bbs-reply-cont">';
	                           
                          		if(typeof(item.parentId) != "undefined" && item.parentId != '')
                          		{
                          			html += '<div class="reply-quotes">\
	                                   <div class="title">回复 '+(item.parentName || "")+'</div>\
	                                   '+item.parentContent+'\
	                               	</div>';
                          		}
	                           html += item.content+'<div class="pt-10 text-right"><button class="bbs-reply-Btn"  onclick="repayComment($!invitation.id, '+item.id+');">回复</button></div></div>';
	                	}); 
	                   el = $('.bbs-list');
	                   el.append(html);
	                   loadingStep = 0;
	                   var start = $("#start").val();
	                   $("#start").val(start + jsonArray.length);
                	}
                	pullUpEl.removeClass('loading');
                    pullUpL.html('上拉显示更多...');
                    pullUpEl['class'] = pullUpEl.attr('class');
                    pullUpEl.attr('class','').hide();
                    myScroll.refresh();
                }
            });
        }, 1000);
    }

    function loaded() {
        pullUpEl = $('#pullUp');
        pullUpL = pullUpEl.find('.pullUpLabel');
        pullUpEl['class'] = pullUpEl.attr('class');
        pullUpEl.attr('class','').hide();

        myScroll = new IScroll('#wrapper', {
            probeType: 2,//probeType：1对性能没有影响。在滚动事件被触发时，滚动轴是不是忙着做它的东西。probeType：2总执行滚动，除了势头，反弹过程中的事件。这类似于原生的onscroll事件。probeType：3发出的滚动事件与到的像素精度。注意，滚动被迫requestAnimationFrame（即：useTransition：假）。
            scrollbars: true,//有滚动条
            mouseWheel: true,//允许滑轮滚动
            fadeScrollbars: true,//滚动时显示滚动条，默认影藏，并且是淡出淡入效果
            bounce:true,//边界反弹
            shrinkScrollbars:'scale',// 当滚动边界之外的滚动条是由少量的收缩。'clip' or 'scale'.
            click: true ,// 允许点击事件
            momentum:true// 允许有惯性滑动
        });
        //滚动时
        myScroll.on('scroll', function(){
            if(loadingStep == 0 && !pullUpEl.attr('class').match('flip|loading')){
                if (this.y < (this.maxScrollY - 5)) {
                    //上拉刷新效果
                    pullUpEl.attr('class',pullUpEl['class'])
                    pullUpEl.show();
                    myScroll.refresh();
                    pullUpEl.addClass('flip');
                    pullUpL.html('上拉查看更多回复...');
                    loadingStep = 1;
                }
            }
        });
        //滚动完毕
        myScroll.on('scrollEnd',function(){
            if(loadingStep == 1){
                if (pullUpEl.attr('class').match('flip|loading')) {
                    pullUpEl.removeClass('flip').addClass('loading');
                    pullUpL.html('正在加载...');
                    loadingStep = 2;
                    pullUpAction();
                }
            }
        });
    }

/*     document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
    window.onload = function() {
        loaded();
    }; */
    
    function repayComment(invitationId ,commentId)
    {
    	if(isAndroid)
		{
    		java.requestComm(invitationId, commentId);
		}
		if(isiOS)
		{
			requestComm(invitationId, commentId);
		}
    }
    
    function replyCircle(invitationId)
    {
    	if(isAndroid)
		{
    		java.replyInvitation(invitationId);
		}
		if(isiOS)
		{
			replyInvitation(invitationId);
		}
    }
    
</script>


<script type="text/javascript" src="${staticPath}/static/app/assets/widget/dialog/classie.js"></script>
<script type="text/javascript" src="${staticPath}/static/app/assets/widget/dialog/dialogFx.js"></script>
<script type="text/javascript">
(function() {

	var dlgtrigger = jQuery("[data-dialog]"), somedialog = document.getElementById("somedialog"), dlg = new DialogFx(somedialog);
    dlgtrigger.click(function() {
    	$(somedialog).find(".dialog__content").html('<img src="'+ $(this).attr("data-dialog") +'" />');
    	dlg.toggle.call(dlg);
    }); 

})();

function is_weixin(){
	var ua = navigator.userAgent.toLowerCase();
	if(ua.match(/MicroMessenger/i)=="micromessenger") {
		return true;
 	} else {
		return false;
	}
}

$(document).ready(function(){
	if(getUrlPar('ysysgo_app')!=null){
		$(".float_bottom,#info,#gzgzh").show();
	}else{
		$(".float_bottom,#info,#gzgzh").hide();
	}
	
	var tit=getUrlPar('tit');
	if(tit!=null){
		document.title=Base64.decode(tit);
	}
	
	$(".guanzhu").on("click",function(){
		gzhBox();
	});
	
    $(".float_bottom .close").height($(".float_bottom .close").width()).css("top",$(".float_bottom").width()*0.22*0.07);
    $(".float_bottom .close").click(function(){
        $(".float_bottom").hide();
    });
});
</script>
 
  <script type="text/javascript" src="${staticPath}/static/js/weixin/jweixin-1.0.0.js"></script>
  <script type="text/javascript" src="${staticPath}/static/js/weixin/wx_share.js?v=1555"></script>
  <script src="${apiPath}/resources/js/jquery.easing.min.js"></script>
  <script src="${apiPath}/resources/js/tips.js"></script>
  <script type="text/javascript">
	jQuery(document).ready(function(){
		var des=getUrlPar('des');
		if(des!=null){
			tips(des);
		}
	});
  </script>
     <!-- 微信分享 -->    
    <script>
    jQuery(document).ready(function(){   
	    wxConfig('${appId}',${timestamp},'${nonceStr}','${signature}');
	    
	    var title='${invitation.title}';
	    var desc="";
	    
	    #set($str=$!{invitation.content})   
	    #if($str.length()>30)  
		    #set($str=$str.substring(0,30))  
		    desc='$str ...';  
	    #else  
	       desc='$!{invitation.content}';  
	    #end   

	    /* var link='${currentUrl}';
	     */
	     var link=location.href;
		    
	     var imgUrl='${invitation.headImgPath}';
	    wxReady(title,desc,link,imgUrl);
    }); 
    </script>   

</body>
</html>