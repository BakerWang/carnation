<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>订单支付</title>
<link href="$!webPath/resources/style/system/front/default/css/goods2.css" type="text/css" rel="stylesheet" />
<link
	href="$!webPath/resources/style/system/front/default/css/public2.css"
	type="text/css" rel="stylesheet" />
<link rel="stylesheet" type="text/css"
	href="$!webPath/resources/shop/yugou/css/yunGo.css" />
<link href="$!webPath/resources/style/common/css/overlay.css"
	type="text/css" rel="stylesheet" />
<style>
.white_content {
	left: 50%; margin-left: -210px
}

.nav {
	padding-top: 10px
}
.order_info{width: auto;margin-top:35px}
.pay_detail .yun_pay .right .yun_text{width:115px}
.pay_detail .crash_pay_type .right .paytype .icon_yunbi {
    background: url($!webPath/resources/img/icon_yunbi.png) no-repeat;
    width: 122px;
    height: 37px;
    display: block;
    margin:12px 0 0 40px;
}
.pswBox .title{text-indent:0;text-align:center}
.pswBox .title .close{position: absolute;right: 5px;top: 0px;width: 30px;height: 30px;line-height: 30px;text-align: center;color: #949494;text-decoration: none;font-size: 32px;}
.pswBox .tips_text {margin: 35px 0 0 0;font-size: 14px;color: #989898;line-height: 22px;text-align: center;}
.pswBox .pswEnter {margin: 14px 0 0 0;text-align:center}
.pswBox .pswEnter .psw_value {float: none;margin-left:0px;}
.pswBox .btns{margin-left:0}
.pswBox .btnSubmit{background: #18bf97;border-radius: 5px;width: 314px;height: 48px;display: block;text-align:center;
line-height:48px;color:#fff;font-size:18px;margin:0 auto;}
</style>
</head>
<body>

	<script src="$!webPath/resources/js/jquery.min.js"></script>
	$!httpInclude.include("/top.htm") 
	$!httpInclude.include("/head.htm")
	$!httpInclude.include("/nav1.htm")
		<form action="$!webPath/jingxuan-orderPay.htm" method="post" target="_blank"id="theForm">
		<div class="yungoBg">
			<div class="yg_main">
				
				<input type="hidden" name="payType" value="wxqrpay" id="payType">
				<input type="hidden" name="orderId" value="$!orderForm.id">
					
				<div class="order_info">
					<div class="info">
						<div class="info_success">订单提交成功,请您尽快付款！<span class="orderno">订单号：$!orderForm.orderId</span></div>
						<div class="order_no">请您在 <span>72小时</span> 内完成支付，否则订单会被自动取消（商品支付时限以订单详情页为准）。</div>
						<div class="order_prize">
							<span>应付金额:</span><span
								class="prize">$number.format("0",$!orderForm.allIntegral)积分 + $!orderForm.allCashPrice 元</span>
						</div>
					</div>
				</div>
				<div class="payWay_text">支付方式</div>
				<div class="pay_detail">
		
					<div class="yun_pay">
						<div class="name">积分支付</div>
						<div class="right">							
							<div class="yun_remainder">您当前的积分余额为：$!userCustomer.integral 积分 </div>
							
							<div class="yun_text">本次需支付积分</div>
							<div class="pay_num">$number.format("0",$!orderForm.allIntegral)</div>
							
						</div>
					</div>
				
					
					<div class="crash_pay_type">
						<div class="name">现金支付</div>
						<div class="right">
							<div class="choose_text">
								请使用以下付款方式支付余额：<span class="crash_num"><span class="fn-rmb">&yen;&nbsp;</span>$!orderForm.allCashPrice</span>
							</div>
							<div class="paytype">
								<a href="javascript:;" class="wxPay curr" value="wxqrpay">
									<span class="icon_wxpay"></span><span class="choosed"></span>
								</a> 
								<a href="javascript:;" class="aliPay" value="alipay">
									<span class="icon_alipay"></span><span class="choosed"></span>
								</a>
								<a href="javascript:;" class="yunbiPay" value="balance">
									<span class="icon_yunbi"></span><span class="choosed"></span>
								</a>
							</div>
						</div>
					</div>
					<a href="javascript:;" class="icon_comfirmPay pos_comfirmPay" id="btn_submit">确认支付</a>
				</div>
			</div>
		</div>
		<div class="model"></div>
		<input type="submit" id="hideSubmit" style="display: none" />
		<div class="pswBox">
			<div class="title">
				支付密码<a href="javascript:;" class="close">×</a>
			</div>
			<div class="tips_text">
				<span class="star_red">＊</span>为了您的账户安全，请输入您的支付密码。
			</div>
			<div class="pswEnter">
				<input placeHolder="请输入云豆密码" type="password" id="password2" name="paymentPassword" class="psw_value" />
			</div>
			<div class="btns">
				 <a	href="javascript:;" class="btnSubmit"
					onclick="document.getElementById('hideSubmit').click()"
					id="comfirmOrder">确认</a>
			</div>
			<p class="err_tips"></p>
		</div>
	</form>
	<script src="$!webPath/resources/js/jquery.min.js"></script>
	<script src="$!webPath/resources/js/jquery.validate.min.js"></script>
	<script type="text/javascript">
		$(document)
				.ready(
						function() {
							$(".model").css("height", $(document).height());

							$(".pay_result_show .close,.pay_result_show .pay")
									.click(
											function() {
												jQuery('#pay_overlay').hide();
												document.getElementById(
														'theForm').reset();
												jQuery('#ym_err_tips').hide();
											});

							$("#theForm")
									.validate(
											{
												errorPlacement : function(
														error, element) {
													if (element.attr("name") == "paymentPassword") {
														$(".pswBox .err_tips")
																.html("请输入密码")
																.show();
													} else if (element
															.attr("name") == "paymentPassword") {
														$("#ym_err_tips").html(
																"请输入密码").show();
													}
												},
												rules : {
													paymentPassword : {
														required : true
													},
													password2 : {
														required : true
													}
												},
												messages : {
													paymentPassword : {
														required : "密码不能为空"
													},
													password2 : {
														required : "密码不能为空"
													}
												},
												submitHandler : function(form) { //支付云购币+工资或者充值账户
													var h = Math.max(jQuery(
															window).height(),
															jQuery("body")
																	.height());
													var top = document.documentElement.scrollTop;
													jQuery('.black_overlay')
															.css("height", h);
													jQuery('#pay_overlay')
															.show();
													$(".model,.pswBox").hide();
													unlockScreen();
													form.submit();
													$("#countDown").html("30分");
													var total = 30 * 60;
													function timeout() {
														setTimeout(
																function() {
																	total--;
																	var minute = parseInt(total / 60);
																	var second = total % 60;
																	var html = "";
																	html += (minute == 0) ? ""
																			: minute
																					+ "分";
																	html += (second == 0) ? ""
																			: second
																					+ "秒";
																	if (html == "") {
																		html == "0秒";
																	}
																	$(
																			"#countDown")
																			.html(
																					html);
																	if (total >= 1) {
																		timeout();
																	}
																}, 1000)
													}
													timeout();
												}
											});

							$(".paytype a").click(function() {
								$(this).addClass("curr").siblings().removeClass("curr");
								var index = $(this).attr("value");
								$("#payType").val(index);
							});

							$("#bounsPay").click(function() {
								$(".model,.pswBox").show();
								lockScreen();
							});
							
							$("#btn_submit").click(function(){
								var payType=$("#payType").val();
								if(payType=="balance"){
									$(".model,.pswBox").show();
									lockScreen();
								}else{
									$("#theForm").submit();
								}
							});

							function lockScreen() {
								document.body.onkeydown = keyFunc;
								disabledMouseWheel();
							}
							function unlockScreen() {
								document.body.onkeydown = null;
								removeDisabledMouseWheel();
							}

							function disabledMouseWheel() {
								if (document.addEventListener) {
									document.addEventListener('DOMMouseScroll',
											scrollFunc, false);
								}//W3C  
								window.onmousewheel = document.onmousewheel = scrollFunc;//IE/Opera/Chrome  
							}
							function removeDisabledMouseWheel() {
								if (document.addEventListener) {
									document
											.removeEventListener(
													'DOMMouseScroll',
													scrollFunc, false);
								}//W3C  
								window.onmousewheel = document.onmousewheel = null;//IE/Opera/Chrome  
							}
							function scrollFunc(evt) {
								evt = evt || window.event;
								if (evt.preventDefault) {
									// Firefox  
									evt.preventDefault();
									evt.stopPropagation();
								} else {
									// IE  
									evt.cancelBubble = true;
									evt.returnValue = false;
								}
								return false;
							}

							var move = function(e) {
								e.preventDefault && e.preventDefault();
								e.returnValue = false;
								e.stopPropagation && e.stopPropagation();
								return false;
							}
							var keyFunc = function(e) {
								if (37 <= e.keyCode && e.keyCode <= 40) {
									return move(e);
								}
							}

							$(".pswBox .close").click(function(event) {
								$(".model,.pswBox").hide();
								$(".pswBox .err_tips").html("").hide();
								unlockScreen();
							});
						});
	</script>
	$!httpInclude.include("/footer.htm")
	<div style="display: none;" id="pay_overlay">
		<div class="pay_result_show">
			<a href="javascript:;" class="close"></a>
			<div class="tit">
				请于<span id="countDown"></span>内，在新开的页面完成支付
			</div>
			<div class="giveup">
				对产品有疑问，可选择:<a href="javascript:;" class="pay payResultBtn btn1">放弃付款</a>
			</div>
			<div class="completePay">
				如已支付成功，请点击:<a
					href="$!webPath/order_finish.htm?order_id=$!actualBO.order.id"
					class="payResultBtn btn2">已完成付款</a>
			</div>
			<div class="repay">
				付款遇到问题，你可以:<a href="javascript:;" class="pay payResultBtn btn3">重新支付</a>
			</div>
			<div class="tel">支付常见问题，请联系客服电话:4008-355-788</div>
		</div>
		<div class="black_overlay"></div>
	</div>
</body>
</html>
