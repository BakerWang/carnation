<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>填写商品详细信息 - $!{config.poweredby}</title>
<link href="$!webPath/resources/style/system/manage/$!{config.websiteCss}/template.css"  rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="$!webPath/resources/editor/themes/default/default.css" />
<link href="$!webPath/resources/style/common/css/overlay.css" type="text/css" rel="stylesheet" />
<link  href="$!webPath/resources/style/common/css/jquery-ui-1.8.22.custom.css" type="text/css" rel="stylesheet">
<link  href="$!webPath/resources/style/common/css/resizeableImage.css?v=1" type="text/css" rel="stylesheet">
<link  href="$!webPath/resources/css/spec.css" type="text/css" rel="stylesheet">
<link  href="$!webPath/resources/style/auto/main1.css" type=text/css rel=stylesheet>
<!-- <script src="$!webPath/resources/js/jquery-1.6.2.js"></script> -->
<script src="$!webPath/resources/js/jquery.min.js"></script>
<script src="$!webPath/resources/js/jquery-ui-1.8.21.js"></script>
<script src="$!webPath/resources/js/jquery.zh.cn.js"  charset="utf-8"></script>
<script src="$!webPath/resources/js/jquery.shop.common.js"></script>
<script src="$!webPath/resources/js/jquery.shop.base.js"></script>
<script src="$!webPath/resources/js/jquery.validate.min.js"></script>
<script charset="utf-8" src="$!webPath/resources/editor/kindeditor.js"></script>
<script charset="utf-8" src="$!webPath/resources/editor/lang/zh_CN.js"></script>
<script src="$!webPath/resources/js/ajaxfileupload.js"></script>
<script src="$!webPath/resources/js/resizeableImage.js?v=0710"></script>


<script src="$!webPath/resources/js/auto/jquery.autocompleter.js"></script>
<script src="$!webPath/resources/js/auto/main.js"></script>
<style>
.message_white_box_del{
	height:auto
}
</style>
<script>
jQuery.validator.addMethod("profix", function(value, element) {
    return /^[0-9a-zA-Z]{0,6}$/.test(value);
}, "前缀必须是6字之内字母数字的组合");

/* jQuery.validator.addMethod("bv", function(value, element) {
    return /^\d+(?:\.0{1,2})?$/.test(value);
}, "请输入整数"); */

jQuery.validator.addMethod("yunGoMax", function(value, element) {
	var storePrice=jQuery("#store_price").val();
	if(Number(value)>Number(storePrice)){
		return false;
	}else{
		return true;
	}
    
}, "云购币不能大于店铺价格");

jQuery.validator.addMethod("f_code_profix",
    function(value, element) {
        if (jQuery(':radio[id=f_sale_type][value=1]').attr('checked')&&jQuery("#f_code_json").val()==""){
	        	if (jQuery('#f_code_profix').val() == ''){
	        		return false;
	        	}else{
	        		return true;
	        	}
        }else{
        	return true;
        }}
    );
    
jQuery.validator.addMethod("f_code_count",
    function(value, element) {
        if (jQuery(':radio[id=f_sale_type][value=1]').attr('checked')&&jQuery("#f_code_json").val()==""){
	        	if (jQuery('#f_code_count').val() == ''){
	        		return false;
	        	}else{
	        		return true;
	        	}
        }else{
        	return true;
        }}
    );
  jQuery.validator.addMethod("transportId",
    function(value, element) {
        if (jQuery(':radio[id=goods_transfee][value=0]').attr('checked') && jQuery(':radio[id=transport_type][value=0]').attr('checked')){
	        	if (jQuery('#transport_id').val() == ''){
	        		return false;
	        	}else{
	        		return true;
	        	}
        }else{
        	return true;
        }}
    );
  
//options为编辑配置属性pc
var options1 = {
        cssPath : '$!webPath/resources/editor/plugins/code/prettify.css',
        filterMode : true,
		uploadJson:'$!webPath/file/upload.htm?module=goods/detail/pc',
		width : '860px',
		height:'400px',
		resizeType : 1,
		allowImageUpload : true,
		allowFlashUpload : false,
		allowMediaUpload : false,
		allowFileManager : false,
		syncType:"form",
		afterCreate : function() {
							var self = this;
							self.sync();
						},
		afterChange : function() {
							var self = this;
							self.sync();
						},
		afterBlur : function() {
							var self = this;
							self.sync();
						},
		items:['source', '|', 'fullscreen', 'undo', 'redo', 'cut', 'copy', 'paste',
			'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
			'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
			'superscript', '|', 'selectall', 'clearhtml','quickformat','|',
			'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
			'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image','multiimage','flash', 'media', 'table', 'hr', 'emoticons', 'link', 'unlink', '|', 'about']
};
//options为编辑配置属性app
var options2 = {
        cssPath : '$!webPath/resources/editor/plugins/code/prettify.css',
        filterMode : true,
		uploadJson:'$!webPath/file/upload.htm?module=goods/detail/mb',
		width : '360px',
		height:'400px',
		minWidth:'360px',
		resizeType : 1,
		allowImageUpload : true,
		allowFlashUpload : false,
		allowMediaUpload : false,
		allowFileManager : false,
		syncType:"form",
		afterCreate : function() {
							var self = this;
							self.sync();
						},
		afterChange : function() {
							var self = this;
							self.sync();
						},
		afterBlur : function() {
							var self = this;
							self.sync();
						},
		items:['source', '|', 'undo', 'redo', '|', 'justifyleft', 'justifycenter',  'insertorderedlist', 'insertunorderedlist', '|',
			'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
			'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image', 'multiimage', 'hr', '|', 'about']
};
var user_goods_class_count=2;
function valChange(val){
	  var tempval=val.replace(/[^0-9.]/g,'').replace(/^\./g,"");
	  var tempArr=tempval.split('.');
	  if(tempArr.length>1){
		  tempval=tempArr[0]+"."+tempArr[1];
	  }else{
		  tempval=tempArr[0];
	  }
	  if(tempArr.length>1&&tempArr[1].length>2){
		  tempval=Number(val).toFixed(2);
	  }
	  return tempval;
}
function priceChange(obj,e){
	  if(e){
		  var e=e||window.event;
	      if(e.keyCode>=37&&e.keyCode<=40) return;  
	  }
	  var val=valChange(obj.val());
	  obj.val(val);
	  var gname=obj.attr("name");
	  jQuery(":input[id=inventory_details_ygb_"+gname+"]").val("");
	  jQuery(":input[id=inventory_details_cash_"+gname+"]").val("0.00");
	  jQuery(":input[id=inventory_details_bv_"+gname+"]").val("0.00").attr("readonly","readonly");
}

jQuery(document).ready(function() {
	
	
	
	var arr=[];
	#foreach($gb in $gbs)
	var tempobj={
		"id":$!gb.id,
		"label":"$!gb.name"
	}
	arr.push(tempobj);					
	#end
	
	
	
	
	$('#nope').autocompleter({
        highlightMatches: true,
        source: arr,
        template: '{{ label }}',
        hint: true,
        empty: false,
        limit: 5,
        callback: function (value, index, selected) {
            if (selected) {
                $('#goodsBrandId').val(selected.id);
//                 alert( $("#nope").val());
            }
        }
    });
	
	
	
	
	
	
	
	
	jQuery(":input").each(function(){
		jQuery(this).attr("autocomplete","off");
	});
	
	draw_goods_main_img();
	jQuery(".upload_pictures_bottom ul").sortable({stop: function(event,ui){},start:function(event,ui){},revert: true});
	jQuery(".upload_pictures_bottom ul").bind('sortstop',
		function(event, ui){
			draw_goods_main_img();
			jQuery(ui.item).css("cursor","auto");
		});
	jQuery(".upload_pictures_bottom ul").bind('sortstart',
		function(event, ui){
			jQuery(ui.item).css("cursor","move");
		});
	jQuery(".upload_pictures_bottom ul" ).disableSelection();
  jQuery(":radio[id=goods_status]").click(function(){
    if(jQuery(this).val()==2){
	   jQuery("#publish_info").show();
	 }else{
       jQuery("#publish_info").hide();
	 }
  });

    //
  jQuery('#publish_day').attr("readonly","readonly").datepicker({
	  dateFormat:"yy-mm-dd",
	  minDate:0,
	  changeMonth: true,
	  changeYear: true
  });
  //
  jQuery('#advance_date').attr("readonly","readonly").datepicker({
	  dateFormat:"yy-mm-dd",
	  minDate:0,
	  changeMonth: true,
	  changeYear: true
  });
  
 //默认赋值
 // jQuery(":radio[id='goods_transfee'][value='$!{obj.goodsTransfee}']").attr("checked",true);
  jQuery(":radio[id='goods_status'][value='$!{obj.goodsStatus}']").attr("checked",true);
  #if($!edit)
	  jQuery(":radio[id='inventory_type'][value='$!{obj.inventoryType}']").attr("checked",true);
  #end  	  
  

  jQuery(":radio[id='goods_choice_type'][value='$!{obj.goodsChoiceType}']").attr("checked",true);
  jQuery(":radio[id='goods_cod'][value='$!{obj.goodsCod}']").attr("checked",true);
  jQuery(":radio[id='hasMobilePrice'][value=#if($!{obj.hasMobilePrice}) '1' #else '0' #end]").attr("checked",true);
  jQuery(":radio[id='hasExchangeIntegral'][value=#if($!{obj.hasExchangeIntegral}) '1' #else '0' #end]").attr("checked",true);
  jQuery("#goods_brand_id").val("$!obj.goodsBrandId");
  jQuery(":radio[id='f_sale_type'][value='$!{obj.fSaleType}']").attr("checked",true);
  jQuery(":radio[id='advance_sale_type'][value='$!{obj.advanceSaleType}']").attr("checked",true);
  jQuery("#goods_top_format_id").val("$!obj.goodsTopFormatId");
  jQuery("#goods_bottom_format_id").val("$!obj.goodsBottomFormatId");
  #foreach($spec in $obj.goodsSpecsList)
    jQuery(":checkbox[id=spec_$!{spec.id}]").attr("checked",true);
  #end
  #if($!obj.inventoryType=="spec")
   var goods_spec_ids="";
  jQuery(".js-sku-atom-container .js-sku-atom-list .sku-atom span[data-atom-id]").each(function(){
	     goods_spec_ids=jQuery(this).attr("data-atom-id")+","+goods_spec_ids;
	  });
   	 jQuery.ajax({async:false,type:'POST',url:'$!webPath/admin/goods_inventory.htm?_'+new Date().getTime(),dataType:"text",data:"goods_spec_ids="+goods_spec_ids,
			  success:function(data){
					jQuery("#inventory_detail_content").append(data);
						 jQuery("#inventory_detail").show();
						 var inventory_detail='$!obj.goodsInventoryDetail';
						 var goods_inventory_detail=eval("("+inventory_detail+")");
						 jQuery.each(goods_inventory_detail, function(index,item){
							 //console.log(item);
							jQuery("input[id^=inventory_details_count_]").each(function(){
					        	if($(this).attr("name").split("_").sort().toString()==item.id.split("_").sort().toString()){
					        		$(this).val(item.count);
					        	}
					        });
							jQuery("input[id^=inventory_details_price_]").each(function(){
					        	if($(this).attr("name").split("_").sort().toString()==item.id.split("_").sort().toString()){
					        		$(this).val(item.price);
					        	}
					        });
							jQuery("#inventory_details_ygb_"+item.id).val(item.needYgb);
							jQuery("#inventory_details_cash_"+item.id).val(item.needMoney);
							jQuery("#inventory_details_bv_"+item.id).val(item.cnSelfAddPrice);
							jQuery("#inventory_details_mobile_price_"+item.id).val(item.mobilePrice);
							jQuery("#inventory_details_integral_count_"+item.id).val(item.integralCount);
							jQuery("#inventory_details_integral_price_"+item.id).val(item.integralPrice);						  
						 });
						 if(jQuery("#inventory_detail_content>table").height()>=350){
							jQuery("#inventory_detail_content").css({"width":"98%","height":"350px","overflow":"auto"});
						  }else{
							jQuery("#inventory_detail_content").css({"width":"98%","height":"auto","overflow":"auto"});
						  }
			 }
	});


  #end
  #if($!obj.goodsProperty)
  var data='$!obj.goodsProperty';
  var properties=eval("("+data+")");
  jQuery.each(properties,function(index,item){
      jQuery("#property_"+item.id).val(item.val);
  });
  #end
  

  //表单验证
  jQuery("#theForm").validate({
	ignore: "",
     rules: {
	        goodsClassId:{
			     required:true
			},
			 goodsSerial:{
			     maxlength:20
			},
			goodsName:{
			     required:true,
				 minlength:3,
				 maxlength:50
			    },
			 goodsPrice:{
			    required:true,
				number:true,
				range:[0.01,1000000]
			 },			
			 goodsMobilePrice:{
				number:true
			 },
			 exchangeIntegral:{
				number:true,
				range:[0,1000000]
			 },
			 goodsIntegralPrice:{
				number:true,
				range:[0,1000000]
			 },
			 goodsWeight:{
				number:true,
				range:[0.01,1000000]
				},
			goodsVolume:{
				number:true,
				range:[0.01,1000000]
				},
			storePrice:{
			    required:true,
				number:true,
				range:[0.01,1000000],
				priceCompare:true
			 },
			 selfAddPrice:{
				    required:true,
					number:true,
					balance:true
			},
			 goodsInventory:{
			    required:true, 
			    number:true,
				range:[1,1000000000]
			 },
			 transportId:{transportId:true},
			 fCodeProfix:{f_code_profix:true,rangelength:[1,4],profix:true},
			 fCodeCount:{f_code_count:true,min:1,max:100000},
			 sortWeight:{digits:true}
			},
     messages: {
	        goodsClassId:{required:"商品分类不能为空"},
			goodsSerial:{maxlength:"输入字符长度不得超过20"},
			goodsName:{
			    required: "商品名不能为空",
			    minlength:"商品名最少为3个字符",
			    maxlength:"商品名最多为50个字符"
			  },
			goodsPrice:{
			    required:"商品原价不能为空",
				number:"商品原价只能是数字格式",
				range:"商品价格只能在0.01-1000000之间"
				},
			goodsMobilePrice:{
				number:"手机专享价只能是数字格式",
				range:"手机专享价只能在0.01-1000000之间"
			 },
			 exchangeIntegral:{
				 number:"兑购积分只能是数字格式",
					range:"兑购积分只能在1-1000000之间"
			 },
			 goodsIntegralPrice:{
				 number:"兑购后价格只能是数字格式",
					range:"兑购后价格只能在0.01-1000000之间"
			 },
			goodsWeight:{
				number:"只能输入小数及整数"
				},
			goodsVolume:{
				number:"只能输入小数及整数"
				},
			storePrice:{
			    required:"店铺价格不能为空",
				number:"店铺价格只能是数字格式",
				range:"店铺价格只能在0.01-1000000之间",
				priceCompare:"店铺价格不能大于商品原价"
				},
			selfAddPrice:{
				    required:"利润价格不能为空",
					number:"利润价格只能是数字格式"
			},		
			goodsInventory:{
			    number:"商品库存只能为数字",
				range:"商品库存数量只能在1-1000000000之间"
			},
			transportId:{transportId:"请选择一个运费模板"},
			fCodeProfix:{f_code_profix:"请输入F码前缀",rangelength:"F码前缀长度为{0}位-{1}位"},
			fCodeCount:{f_code_count:"F码数量不能为空",min:"F码数量最小为1",max:"F码数量最大为100000"},
		    sortWeight:{digits:"请输入整数"}
		  },
		  submitHandler: function (form) {
			  saveForm(form);
		  }

  });
  
  jQuery.validator.addMethod("balance", function(value,element) {
      var store_price= parseFloat(jQuery("#store_price").val());
      var selfAddPrice=parseFloat(jQuery("#selfAddPrice").val()); 
      
    return this.optional(element) || selfAddPrice < store_price;   
  }, jQuery.validator.format("利润不能大于店铺价格"));
  
  jQuery.validator.addMethod("priceCompare", function(value,element) {
      var store_price= parseFloat(jQuery("#store_price").val());
      var goods_price=parseFloat(jQuery("#goods_price").val()); 
      
    return store_price<=goods_price;   
  }, jQuery.validator.format("店铺价格不能大于商品原价"));
  
  //自动计算总库存
  jQuery("#inventory_detail_content").on("keyup",":input[id^=inventory_details_count_]",function(){
     var goods_inventory=0;
	 jQuery(":input[id^=inventory_details_count_]").each(function(){
		var reg = new RegExp("^[0-9]*$");
		if(!reg.test(jQuery(this).val())){
		    jQuery(this).val("0");
		}		
		if(jQuery(this).val()!=""){
			goods_inventory=parseInt(jQuery(this).val())+goods_inventory;
		}
	 });
	 jQuery("#goods_inventory").val(goods_inventory);
  });
   //
  jQuery(":input[id^=inventory_details_price_]").on("keyup",function(e){	
		 priceChange(jQuery(this),e);
  });
   

  jQuery(":input[id^=inventory_details_integral_count_]").on("keyup",function(){
	 jQuery(":input[id^=inventory_details_integral_count_]").each(function(){
		 var e=e||window.event;
		 if(e.keyCode>=37&&e.keyCode<=40) return;
		 var val=jQuery(this).val().replace(/[^0-9.]/g,'').replace(/^\./g,"");
		 var arr= val.split('.');
		 if(arr.length>1){
			 val=arr[0]+"."+arr[1];
		 }else{
			 val=arr[0];
		 }
		 if(arr.length>1&&arr[1].length>2){
			 val=Number(val).toFixed(2)
		 }
		 jQuery(this).val(val);		 
		 if(jQuery(this).val()=="") jQuery(this).val("0.00");
	 });
  });
 
  jQuery(":input[id^=inventory_details_mobile_price_]").on("keyup",function(e){
		 var e=e||window.event;
		 if(e.keyCode>=37&&e.keyCode<=40) return;
		 var val=jQuery(this).val().replace(/[^0-9.]/g,'').replace(/^\./g,"");
		 var arr= val.split('.');
		 if(arr.length>1){
			 val=arr[0]+"."+arr[1];
		 }else{
			 val=arr[0];
		 }
		 if(arr.length>1&&arr[1].length>2){
			 val=Number(val).toFixed(2)
		 }
		 jQuery(this).val(val);		 
		 if(jQuery(this).val()=="") jQuery(this).val("0.00");
  });

     //物流运费
  jQuery("#buyer_transport_info").find("input[type='text']").on("keyup",function(){
	 jQuery(":input[id='mail_trans_fee']").each(function(){
		 var e=e||window.event;
		 if(e.keyCode>=37&&e.keyCode<=40) return;
		 var val=jQuery(this).val().replace(/[^0-9.]/g,'').replace(/^\./g,"");
		 var arr= val.split('.');
		 if(arr.length>1){
			 val=arr[0]+"."+arr[1];
		 }else{
			 val=arr[0];
		 }
		 if(arr.length>1&&arr[1].length>2){
			 val=Number(val).toFixed(2)
		 }
		 jQuery(this).val(val);		 
		 if(jQuery(this).val()=="") jQuery(this).val("0.00");
	 });
  });


  //table切换
  jQuery("#ul_table li").click(function(){
	jQuery(this).parent().find("li a").removeClass("this");
	jQuery(this).find("a").addClass("this");
	var id =jQuery(this).attr("id");
	jQuery("table").not(".spec").hide();
	jQuery("table[id=goods_"+id+"]").show();
   });
  //
  jQuery(":radio[id=inventory_type]").click(inventory_type);
  jQuery(":checkbox[id^=spec_]").click(inventory_type);
  //
  editor = KindEditor.create('#goods_details_web',options1);
  editor2 = KindEditor.create('#goods_details_app',options2);
  //
  jQuery(":radio[id='goods_transfee']").click(function(){
     var val=jQuery(this).val();
	 if(val==0){
	    jQuery("#buyer_transport_info").show();
	  }else{
	    jQuery("#buyer_transport_info").hide();
	  }
  });
  //
  jQuery(":radio[id=f_sale_type]").click(function(){
     if(jQuery(this).val()==1){
	   jQuery("tr[id^=f_code_]").show();
	 }else{
	   jQuery("tr[id^=f_code_]").hide();
	 }
  });
  //
  jQuery(":radio[id=advance_sale_type]").click(function(){
     if(jQuery(this).val()==1){
	   jQuery("tr[id^=advance_sale_]").show();
	 }else{
	   jQuery("tr[id^=advance_sale_]").hide();
	 }
  });
  //
  jQuery(":radio[id=hasMobilePrice]").click(function(){
     if(jQuery(this).val()==1){
	   jQuery("tr[id^=hasMobilePriceTr]").show();
	 }else{
	   jQuery("tr[id^=hasMobilePriceTr]").hide();
	 }
     inventory_type();
  });
  jQuery(":radio[id=hasExchangeIntegral]").click(function(){
     if(jQuery(this).val()==1){
	   jQuery("tr[id^=hasExchangeIntegralTr]").show();
	 }else{
	   jQuery("tr[id^=hasExchangeIntegralTr]").hide();
	 }
     inventory_type();
  });

});
function inventory_type(){
  var rv=jQuery(":radio[name=inventoryType]:checked").val();
  if(rv=="all"){
	 jQuery("#inventory_detail_content").empty();
    jQuery("#inventory_detail").hide();
  }else{
  jQuery("#inventory_detail_content").empty();
  var goods_spec_ids="";
  jQuery(".js-sku-atom-container .js-sku-atom-list .sku-atom span[data-atom-id]").each(function(){
     goods_spec_ids=jQuery(this).attr("data-atom-id")+","+goods_spec_ids;
  });
  jQuery.post("$!webPath/admin/goods_inventory.htm",{"goods_spec_ids":goods_spec_ids},function(data){
     jQuery("#inventory_detail_content").append(data);
     jQuery("#inventory_detail").show();
	 if(jQuery("#inventory_detail_content>table").height()>=350){
	    jQuery("#inventory_detail_content").css({"width":"98%","height":"350px","overflow":"auto"});
	  }else{
	    jQuery("#inventory_detail_content").css({"width":"98%","height":"auto","overflow":"auto"});
	  }
   },"text");
 }
}
/*Ajax分页*/
function ajaxPage(url,currentPage,obj){
  var ajax_page=jQuery(obj).parent().attr("ajax_page");
  if(ajax_page=="goods_transport"){
     jQuery.post("$!webPath/admin/goods_transport.htm",{"currentPage":currentPage,"ajax":true},function(data){
         jQuery("#ListForm").empty().html(data);
      },"html");
  }else if(ajax_page=="goods_img"){
     var ajax_type=jQuery(obj).parent().attr("ajax_type");
     var type=jQuery(obj).parent().attr("type");
	 var album_id=jQuery(obj).parent().attr("album_id");
     jQuery.post("$!webPath/admin/goods_img.htm",{"currentPage":currentPage,"type":type,"album_id":album_id},function(text){
       jQuery(ajax_type).empty();
	   jQuery(ajax_type).append(text);
     },"text");

  }else if(ajax_page=="goods_album"){
	  var ajax_type=jQuery(obj).parent().attr("ajax_type");
     jQuery.post("$!webPath/admin/goods_album.htm",{"currentPage":currentPage,"ajax_type":ajax_type},function(text){
       jQuery(ajax_type).empty();
	   jQuery(ajax_type).append(text);
     },"text");
  }
}
function saveForm(form){
  editor.sync();//同步编辑器的数据到texterea
  editor2.sync();
   var goods_price=$("#goods_price").val();
   var spec_price_flag=false;
   var price_store_flag=false;
  $("input[id^=inventory_details_price_]").each(function(){
 	 if(Number($(this).val())==0){ 		
 		spec_price_flag=true;
 		 return false;
 	 }
 	if(Number($(this).val())>Number(goods_price)){
   		price_store_flag=true;
   		return false;
   	 }
  });
  if(spec_price_flag){
  	showDialog("warning","","每种规格的价格均不能为0",2,"warning",3);
  	return;
  }
  if(price_store_flag){
  	showDialog("warning","","每种规格的价格均不能大于商品原价",2,"warning",3);
  	return;
  }
  /*商品图片处理*/
	if(jQuery(".upload_pictures_bottom_i img").size() < 1){
	   showDialog("warning","","请至少上传一张商品图片！",2,"warning",3);
	}
	else if(false)
	{
	  showDialog("warning","","请至少选择一种规格！",2,"warning",3);
	}
	else{
		var image_ids="";
		var main_image_id="";
		jQuery(".upload_pictures_bottom_i img").each(function(index, element) {
			
			if(index==0){
				main_image_id=jQuery(element).attr("src");
			}else{
// 				if(jQuery(element).attr("img_id") != 0)
// 				{
					var image_id=jQuery(element).attr("src");
						image_ids=image_ids+"|"+image_id;
// 				}
			}
			
	
		});
	  jQuery("#image_ids").val(image_ids);
	  jQuery("#goods_main_img_id").val(main_image_id);
		
	  var goods_spec_ids="";
		jQuery(".js-sku-atom-container .js-sku-atom-list .sku-atom span[data-atom-id]").each(function(){
			goods_spec_ids=jQuery(this).attr("data-atom-id")+","+goods_spec_ids;
	  	});
		jQuery("#goods_spec_ids").val(goods_spec_ids);
		console.log(goods_spec_ids+"=======规格属性ID");
	//判断规格图片是否全部上传
	if(jQuery(".sku-sub-group").length>=1&&jQuery("#js-addImg-function").prop("checked")){
		var len=jQuery(".sku-sub-group").eq(0).find(".sku-atom").length;
		var len2=jQuery(".sku-sub-group").eq(0).find(".js-enter-wrap img").length;
		if(len!=len2){
			spec_return._alert("请上传规格图片");
			return;
		}
	}  
	//规格图片
	if($("#js-addImg-function").prop("checked")){
		var idImg=[];
		$(".sku-sub-group").eq(0).find(".js-sku-atom-list .sku-atom").each(function(){
			var id=$(this).find("span[data-atom-id]").attr("data-atom-id");
			var img=$(this).find(".js-upload-container").attr("url");
			idImg.push(id+"_"+img);
		});
		$("#img_pids").val(idImg.join(";"));
	}
	//规格ID
	var goodsSpecificationIds="";
	$(".sku-sub-group .select2-container .select2-focusser.select2-offscreen").each(function(){
		goodsSpecificationIds=goodsSpecificationIds+","+$(this).val();
	});
	
	var str=goodsSpecificationIds.substr(1 ,goodsSpecificationIds.length) 
	$("#goodsSpecificationIds").val(str);
	console.log(str+"=======规格ID");
	  
	  var goods_properties="";
	  jQuery("select[id^=property_]").each(function(){
		if(jQuery(this).val()!=""){
		   goods_properties=jQuery(this).attr("id").substring(9)+","+jQuery(this).val()+";"+goods_properties;
		}
	  });
	  jQuery("#goods_properties").val(goods_properties);
	  var intentory_details="";
	  jQuery("input[id^=inventory_details_count_]").each(function(){
		 var id=jQuery(this).attr("name");
		 var count=jQuery(this).val();
		 
		 var price=jQuery("#inventory_details_price_"+id).val()||0;
		 var ygb=jQuery("#inventory_details_ygb_"+id).val()||0;
		 var money=jQuery("#inventory_details_cash_"+id).val()||0;
		 var cn_price=jQuery("#inventory_details_bv_"+id).val()||0;
		 
		 var mobilePrice=0;
		 var integralCount=0;
		 var integralPrice=0;
		 if(jQuery("#inventory_details_mobile_price_"+id).length>0)
			mobilePrice = jQuery("#inventory_details_mobile_price_"+id).val();
		 if(jQuery("#inventory_details_integral_count_"+id).length>0)
		 	integralCount=jQuery("#inventory_details_integral_count_"+id).val();
		 if(jQuery("#inventory_details_integral_price_"+id).length>0)
		 	integralPrice=jQuery("#inventory_details_integral_price_"+id).val();
		 intentory_details=id+","+count+","+price+","+""+","+""+","+""+","+mobilePrice+","+integralCount+","+integralPrice+";"+intentory_details; 
		
		});
	  jQuery("#intentory_details").val(intentory_details);
	  //jQuery("#theForm").submit();
	  //document.getElementById('theForm').submit();
	//提交时如果云购币加价为空，设置为0
	  if(jQuery(":input[name=needYgb]").val()==""){
		  jQuery(":input[name=needYgb]").val("0");
	  }
	  check();
	  form.submit();
    }
}
function switch_detail_editor(str){
	jQuery("a[id^='detail_']").removeClass("this");
	jQuery("#detail_"+str).addClass("this");

	jQuery("#goods_details_div_web").hide();
	jQuery("#goods_details_div_app").hide();
	jQuery("#goods_details_div_"+str).show();
	if(str=="app")
		jQuery("#goods_details_div_app_content").show();
	else
		jQuery("#goods_details_div_app_content").hide();
}


//商品图片删除
function del_goods_image(img_id,obj){
  if(img_id == "0")
  {
	  if(confirm("删除后不可恢复，是否继续？")){
		var img = $(obj).parent().prev().find("img");
		img_id = $(img).attr("img_id");
		var goods_id = $(img).attr("goods_id");
		jQuery.post("$!webPath/admin/goods_image_del.htm",{"image_id":img_id, "goodsId":goods_id},function(data){
		    if(data.result==true){
				draw_goods_main_img();
				jQuery(".add_img").show();
				jQuery(obj).parent().parent().remove();
			}else showDialog("msg_info","","删除失败!",2,"warning",3,'');
		},"json");
	  }
  }
  else
  {
	  remove_goods_image(obj);
  }
}
function remove_goods_image(obj){
	jQuery(obj).parent().parent().remove();
	draw_goods_main_img();
	jQuery(".add_img").show();
}
//根据传入新图片的URL，绘制下方小图。
function  draw_goods_img(img_url, img_id){
	if(jQuery("#show_img").children().size()==5) {alert("最多可选择5张商品图片"); return;}
	jQuery("#show_img").append("<li><span class='upload_pictures_bottom_i'><img src='"+img_url+"' img_id='"+img_id+"' title='可拖动' /></span><span class='upload_pictures_bottom_del'><a href='javascript:void(0)' onclick='del_goods_image("+img_id+",this)'><img src='/resources/style/system/front/default/images/usercenter/del_right.png' title='删除图片'/></a></span></li>");
	draw_goods_main_img();
	if(jQuery("#show_img").children().size()>=5) jQuery(".add_img").hide();
}
/*绘制商品主图*/
function  draw_goods_main_img(){
	if(jQuery("#show_img").children().size()==0){
		jQuery(".upload_pictures_top_img img").attr("src",null);
	}else if(jQuery("#show_img").children().size()>=1){
		var img_url=jQuery(".upload_pictures_bottom_i img").attr("src");
		jQuery(".upload_pictures_top_img img").attr("src",img_url);
	}
}
//商品图片ajax上传
function upload_goods_img(){
	jQuery(".add_img").removeClass("add_img").addClass("add_loading");
	jQuery.ajaxFileUpload({url:'$!webPath/file/upload.htm?module=goods/main',
								  dataType:'text',
								  fileElementId:['imgFile'],
								  fileFilter:"$!imageSuffix1",
								  success:function(data){
									var json = eval('(' + data + ')'); 
									jQuery(".add_loading").removeClass("add_loading").addClass("add_img");
				 					draw_goods_img(json.url, '-1');
								  },
		});
}
 
</script>

<script type="text/javascript">
      jQuery(function() {
				jQuery("#uploadImg").bind("change",function() {
		            var srcs = getObjectURL(this.files[0]);   	            
		            jQuery(".resize-image").attr("src",srcs);    
		            jQuery(this).val('');
		            resizeableImage(jQuery('.resize-image'));
		        })
		 	})
		    function getObjectURL(file) {
		        var url = null;
		        if (window.createObjectURL != undefined) {
		            url = window.createObjectURL(file)
		        } else if (window.URL != undefined) {
		            url = window.URL.createObjectURL(file)
		        } else if (window.webkitURL != undefined) {
		            url = window.webkitURL.createObjectURL(file)
		        }
		        return url;
		    };
		    
		    function check(){
				var gb = $("#nope").val();
				var arr=[];
				#foreach($gb in $gbs)
				var tempobj={
					"id":$!gb.id,
					"label":"$!gb.name"
				}
				arr.push(tempobj);					
				#end
				
				for(var i=0;i<arr.length;i++){
					if(gb==arr[i].label||gb==""){
						document.forms[0].action = "$!webPath/admin/add_goods_finish.htm";
						document.forms[0].submit();
						break;
					}else if(i == arr.length-1){
						if(gb!=""){
						$("#nope").val("");
						alert("请选择正确的品牌!");
						document.forms[0].action = "javascript:void(0);";
						return false;
						}
					}
				}
		   }
	</script>


<style type="text/css">

.autocompleter {
	width:145px;
    background:#fff;
    position: absolute;
    top: 180px;
    left: 125PX;
    z-index: 100;
}
label.error {
	color: #F00;
	margin-left: 3px;
}
input.error {
	border: 2px solid #F00;
}
.cnAddPrice input{margin:0 10px}
</style>
</head>
<body>
<div class="cont">
  <h3 class="seth">#if($!edit)商品编辑#else商品发布#end</h3>
  <div class="nav_list">
    <ul id="ul_table">
      <li id="info"><a href="javascript:void(0);" class="this"><b>商品详细</b></a></li>
      <li id="img"><a href="javascript:void(0);"><b>商品图片</b></a></li>
      <li id="description"><a href="javascript:void(0);"><b>详情描述</b></a></li>
<!--       <li id="spec"><a href="javascript:void(0);"><b>特殊商品</b></a></li> -->
      <li id="format"><a href="javascript:void(0);"><b>商品版式</b></a></li>
      <li id="pack"><a href="javascript:void(0);"><b>包装清单</b></a></li>
      <li id="other"><a href="javascript:void(0);"><b>其他信息</b></a></li>
      <li id="idximg"><a href="javascript:void(0);"><b>PC首页推荐图片</b></a></li>
    </ul>
  </div>
  <div class="adddetail">
    <form action="$!webPath/admin/add_goods_finish.htm" method="post" enctype="multipart/form-data" name="theForm" id="theForm">
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail" id="goods_info" >
        <tr>
          <td colspan="2" class="tableh1">商品详细</td>
        </tr>
        <tr>
          <td width="95" align="right">商品分类：</td>
          <td><span>$!goods_class_info</span><span class="editbtn">
            <input name="editClass" type="button" id="edit_class" value="编辑" style="cursor:pointer;" onclick="window.location.href='$!webPath/admin/add_goods_first.htm?id=$!obj.id'" />
            <input name="gcId" type="hidden" id="goods_class_id" value="$!{goods_class.id}" />
            <input name="goodsSpecIds" type="hidden" id="goods_spec_ids" />
            <input name="goodsProperties" type="hidden" id="goods_properties" />
            <input type="hidden" name="intentoryDetails" id="intentory_details" />
            <input type="hidden" name="img_pids" id="img_pids" />
            <input type="hidden" name="goodsSpecificationIds" id="goodsSpecificationIds" value=""/>
            <input name="id" type="hidden" id="id" value="$!obj.id" />
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品名称：</td>
          <td class="sptable"><span class="tabtxt1 size1">
            <input name="goodsName" type="text" id="goods_name" value="$!obj.goodsName" />
            </span> <span class="hui2">商品标题名称长度至少3个字符，最长50个汉字</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品原价：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goodsPrice" type="text" id="goods_price" value="$!obj.goodsPrice" />
            </span> <span class="hui2">商品原价必须是0.01~1000000之间的数字</span></td>
        </tr>
        <tr style="display:none;">
          <td align="right" valign="top">商品类型：</td>
          <td class="sptable"><label>
              <input name="goodsChoiceType" type="radio" id="goods_choice_type" value="0" checked="checked" />
              实物商品 </label>
            <label>
              <input type="radio" name="goodsChoiceType" id="goods_choice_type" value="1" />
              虚拟商品 </label>
            <span class="hui2">充值卡、消费券等属于虚拟商品</span></td>
        </tr>
        <tr style="display:none;">
          <td align="right" valign="top">货到付款：</td>
          <td class="sptable"><label>
              <input name="goodsCod" type="radio" id="goods_cod" value="0" checked="checked" />
              支持 </label>
            <label>
              <input type="radio" name="goodsCod" id="goods_cod" value="-1" />
              不支持 </label>
            <span class="hui2">该商品是否支持货到付款</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">店铺价格：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="storePrice" type="text" id="store_price" value="$!obj.storePrice" />
            </span> <span class="hui2">
            <ul class="tableli">
              <li>商品原价必须是0.01~1000000之间的数字</li>
              <li>若启用了库存配置，请在下方商品库存区域进行管理</li>
              <li>商品规格库存表中如有价格差异，店铺价格显示为价格区间形式</li>
            </ul>
            </span></td>
        </tr>
        <tr>
	         <td align="right" valign="top">BV值：</td>
	          <td class="sptable"><span class="tabtxt1 size2">
	            <input name="selfAddPrice" type="text" id="selfAddPrice" value="$!obj.selfAddPrice" />
	            </span> <span class="hui2">
	            <ul class="tableli">
	              <li>商品利润用于分润</li>
	            </ul>
	            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">手机专享价：</td>
          <td class="sptable"><label>
              <input name="hasMobilePrice" type="radio" id="hasMobilePrice" value="0" checked="checked" />
              不支持 </label>
            <label>
              <input type="radio" name="hasMobilePrice" id="hasMobilePrice" value="1" />
              支持 </label>
            <span class="hui2">该商品是否支持手机专享价</span></td>
        </tr>
        <tr #if(!$!{obj.hasMobilePrice}) style="display:none;" #end id="hasMobilePriceTr">
          <td align="right" valign="top">专享价：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goodsMobilePrice" type="text" id="goodsMobilePrice" value="$!obj.goodsMobilePrice" />
            </span> <span class="hui2">
            <ul class="tableli">
              <li>全局手机专享价格必须是0.01~1000000之间的数字</li>
              <li>若启用了库存配置，请在下方商品库存区域进行管理</li>
            </ul>
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">积分兑换：</td>
          <td class="sptable"><label>
              <input name="hasExchangeIntegral" type="radio" id="hasExchangeIntegral" value="0" checked="checked" />
              不支持 </label>
            <label>
              <input type="radio" name="hasExchangeIntegral" id="hasExchangeIntegral" value="1" />
              支持 </label>
            <span class="hui2">该商品是否支持积分兑换</span></td>
        </tr>
        <tr #if(!$!{obj.hasExchangeIntegral}) style="display:none;" #end id="hasExchangeIntegralTr">
          <td align="right" valign="top">积分：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            兑购积分：<input name="exchangeIntegral" type="text" id="exchangeIntegral" value="$!obj.exchangeIntegral" />
            兑购后价格：<input name="goodsIntegralPrice" type="text" id="goodsIntegralPrice" value="$!obj.goodsIntegralPrice" />
            </span> <span class="hui2">
            <ul class="tableli">
              <li>兑购积分必须是1~1000000之间的数字；兑购后价格必须是0.01~1000000之间的数字</li>
              <li>若启用了库存配置，请在下方商品库存区域进行管理</li>
            </ul>
            </span></td>
        </tr>
        <tr>
         
            <td align="right" valign="top">规格设置:</td>
            <td class="sptable"><ul class="color_chose">
            
             #if(!$!edit)
               	 <div class="sku-group">
					<div class="js-sku-list-container"></div>
					<div class="js-sku-group-opts sku-sub-group">
					    <h3 class="sku-group-title">
					        <button type="button" class="js-add-sku-group btn">添加规格项目</button>
					        
					    </h3>
					</div>
				</div>
			#else
 				<div class="sku-group">
					<div class="js-sku-list-container">
						#if($!goodsOldSpecProperty1)
						#foreach($gs in $goodsOldSpecProperty1)
						<div class="sku-sub-group">
							<h3 class="sku-group-title">
								<div class="select2-container js-sku-name select2-drop-above" style="width: 100px;">
									<a href="javascript:void(0)" onclick="return false;" class="select2-choice" tabindex="-1">
										<span class="select2-chosen">$gs.specInfo.name</span>
										<abbr class="select2-search-choice-close"></abbr>
										<span class="select2-arrow"><b></b></span>
									</a>
									
									<input value="$gs.specInfo.specificationId" class="select2-focusser select2-offscreen" type="text" id="s2id_autogen100" disabled="">
								</div>
								<input type="hidden" name="sku_name" value="-1" class="js-sku-name select2-offscreen" tabindex="-1">
								<label for="js-addImg-function" class="addImg-radio"><input checked="checked" type="checkbox" id="js-addImg-function">添加规格图片</label>
								<a class="js-remove-sku-group remove-sku-group">×</a>
							</h3>
							<div class="js-sku-atom-container sku-group-cont">
								<div>
									<div class="js-sku-atom-list sku-atom-list">
											#foreach($gs1 in $gs.propertyInfo)
												#if($gs1.specId==$gs.specInfo.specificationId)
												<div class="sku-atom active">
													<span data-atom-id="$gs1.id">$gs1.value</span>
													<div class="atom-close close-modal small js-remove-sku-atom">×</div>
													<div class="upload-img-wrap">    
														<div class="arrow"></div>    
														<div class="js-upload-container" style="position:relative;" url="$gs1.specImageId" class="js-img-preview">    
															<div class="js-enter-wrap">    
																<a href="javascript:;" class="close-modal small js-btn-close" title="删除">×</a>    
																<img src="$gs1.specImageId" class="js-img-preview">    
																<div class="img-edit js-btn-edit">替换</div>
															</div>
														</div>
													</div>
												</div>
												#end
											
										#end
									</div>
									<a data-addid="$gs.specInfo.specificationId" href="javascript:;" class="js-add-sku-atom add-sku" style="display: inline-block;">+添加</a>
								</div>
								
							</div>
							<div class="sku-group-cont" id="js-tip-instruction" style="padding: 0px 10px; display: block;">    
								<p class="help-desc">目前只支持为第一个规格设置不同的规格图片</p>    
								<p class="help-desc">设置后，用户选择不同规格会显示不同图片</p>    
								<p class="help-desc">建议尺寸：640 x 640像素</p>
							</div>
						</div>
						#end
							
						
						#end
						
						#if($!goodsOldSpecProperty2)					
							#foreach($gs in $goodsOldSpecProperty2)
							<div class="sku-sub-group">
								<h3 class="sku-group-title">
									<div class="select2-container js-sku-name select2-drop-above" style="width: 100px;">
										<a href="javascript:void(0)" onclick="return false;" class="select2-choice" tabindex="-1">
											<span class="select2-chosen">$gs.specInfo.name</span>
											<abbr class="select2-search-choice-close"></abbr>
											<span class="select2-arrow"><b></b></span>
										</a>
										<input value="$gs.specInfo.specificationId" class="select2-focusser select2-offscreen" type="text" id="s2id_autogen100" disabled="">
									</div>
									<input type="hidden" name="sku_name" value="-1" class="js-sku-name select2-offscreen" tabindex="-1">
									<a class="js-remove-sku-group remove-sku-group">×</a>
								</h3>
								<div class="js-sku-atom-container sku-group-cont">
									<div>
										<div class="js-sku-atom-list sku-atom-list">
										#foreach($gs1 in $gs.propertyInfo)
											#if($gs1.specId==$gs.specInfo.specificationId)												
												<div class="sku-atom">
													<span data-atom-id="$gs1.id">$gs1.value</span>
													<div class="atom-close close-modal small js-remove-sku-atom">×</div>
													<div class="upload-img-wrap hide">    
														<div class="arrow"></div>    
														<div class="js-upload-container" style="position:relative;">            
															<div class="add-image js-btn-add">+</div>    
														</div>
													</div>
												</div>
											#end
										#end											
										</div>
										<a data-addid="$gs.specInfo.specificationId" href="javascript:;" class="js-add-sku-atom add-sku" style="display: inline-block;">+添加</a>
									</div>
								</div>
							</div>									
								 
							#end
							#if($!goodsOldSpecProperty1.size()>0)
							
							#else
								<script>
								$(".sku-sub-group").eq(0).find(".js-sku-name.select2-offscreen").after("<label for=\"js-addImg-function\" class=\"addImg-radio\"><input type=\"checkbox\" id=\"js-addImg-function\">添加规格图片</label>");
								$(".sku-sub-group").eq(0).find(".js-sku-atom-container.sku-group-cont").after("<div class=\"sku-group-cont\" id=\"js-tip-instruction\" style=\"padding: 0px 10px; display: block;\"><p class=\"help-desc\">目前只支持为第一个规格设置不同的规格图片</p><p class=\"help-desc\">设置后，用户选择不同规格会显示不同图片</p><p class=\"help-desc\">建议尺寸：640 x 640像素</p></div>");
								</script>
							#end
						#end
						
					</div>
					<div class="js-sku-group-opts sku-sub-group">
					    <h3 class="sku-group-title">
					        <button type="button" class="js-add-sku-group btn">添加规格项目</button>			        
					    </h3>
					</div>
					<script>
					if(jQuery(".js-sku-list-container .sku-sub-group").length>=3){
						$(".js-sku-group-opts.sku-sub-group").hide();
					}
					</script>
				</div>
				#end
              </ul></td>
          </tr>
        <tr >
          <td align="right" valign="top">库存配置：</td>
          <td class="sptable"><label>
              <input name="inventoryType" id="inventory_type" data-all="all" type="radio" value="all" checked="checked" />
              全局配置 </label>
            <label>
              <input type="radio" name="inventoryType" id="inventory_type" value="spec" />
              规格配置 </label>
            <span class="hui2">
            <ul class="tableli">
              <li>全局配置表示所有规格无单独库存、价格配置</li>
              <li>规格配置需要配置对应属性的库存、价格</li>
            </ul>
            </span></td>
        </tr>
        <tr id="inventory_detail" style="display:none;">
          <td align="right" valign="top">详细库存：</td>
          <td class="sptable"><div id="inventory_detail_content" style="width:98%;height:auto;overflow:auto;"></div></td>
        </tr>
        <tr >
          <td align="right" valign="top">商品库存：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goodsInventory" type="text" id="goods_inventory" value="$!obj.goodsInventory" />
            </span> <span class="hui2">
            <ul class="tableli">
              <li>商铺库存数量必须为1~1000000000之间的整数</li>
              <li>若启用了库存配置，则系统自动计算商品的总数，此处无需商家填写</li>
            </ul>
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品货号：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goodsSerial" type="text" id="goods_serial" value="$!obj.goodsSerial" />
            </span> <span class="hui2">
            <ul class="tableli">
              <li>商品货号是指商家个人管理商品的编号，买家不可见</li>
              <li>最多可输入20个字符，支持输入中文、字母、数字、_、/、-和小数点</li>
            </ul>
            </span></td>
        </tr>
        
        <tr>
          <td align="right" valign="top">关键字</td>
          <td class="sptable">
			<span class="hui2">
			<ul class="set1">
				<li><span class="webname"><input type="hidden" id="kid_typeid" name="keyWordIdStr" value="#foreach($skmResult in $skmResult) $!skmResult.kId,  #end">
				</span>
	            <span class="editbtn">
	            <input onclick="showKeywordsBox()" name="editClass" id="edit_class" value="选择" style="cursor:pointer;" onclick="window.location.href='http://localhost:8080/admin/add_goods_first.htm?id=2'" type="button">
	            </span>			
				<span id="keywordslist">#foreach($skmResult in $skmResult) $!skmResult.kName  #end</span>
				</li>
		   </ul>
            </span></td>
        </tr>
       
        
      </table>
      <table id="goods_img" style="display:none" width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail">
        <tr>
          <td class="tableh1" colspan="2">商品图片</td>
        </tr>
        <tr>
          <script>
		    function photo_switch(clz,obj){
			 if(clz=="tab_body_b"){
			 var album_id = jQuery(obj).attr("album_id");
			 jQuery.post("$!webPath/admin/goods_img.htm",{"type":"goods_img_album","album_id":album_id},function(text){
				jQuery(".tab_body_b").empty();
				jQuery(".tab_body_b").append(text);
			  },"text");
			 }
			 jQuery("."+clz).show();
			}
			function show_album(clz,obj){
				 jQuery(".tabbody_ul li").removeClass("this");
			 	 jQuery(obj).addClass("this");
				 jQuery(".tab_body_b").empty();
			 	 if(clz=="tab_body_b"){
			 		 jQuery.post("$!webPath/admin/goods_album.htm",{"ajax_type":".tab_body_b"},function(text){
				 	 jQuery(".tab_body_b").empty();
				 	 jQuery(".tab_body_b").append(text);
			       		 },"text");
				}
			}
		  </script>
          <td><!--商品图片上传 -->

            <div class="tab_body" style="width: 1040px;margin-left: 40px">
              <ul class="tabbody_ul">
                <li class="this" style="cursor:pointer;" onclick="show_album('tab_body_a',this)">上传图片</li>
                <li style="cursor:pointer;" onclick="show_album('tab_body_b',this)">从用户相册选择</li>
              </ul>
              <div class="tabbodys" style="width: 1038px;">
                <div class="tab_body_b" style="width: 1040px;"></div>
                <div class="tab_body_a" style="width: 1040px;">
                  <div class="upload_pictures">
                    <div class="upload_pictures_top">
                      <div class="upload_pictures_top_img"><img #if($!obj.goodsMainPhotoPath)
                    src="$!{obj.goodsMainPhotoPath}"
                    #end /></div>
                    </div>
                    <div class="upload_pictures_bottom">
                      <ul id="show_img">
                        #if($!{obj.goodsMainPhotoPath})
                        <li> <span class="upload_pictures_bottom_i"><img src="$!{obj.goodsMainPhotoPath}" img_id="0" title="可拖动" /></span> <span class="upload_pictures_bottom_del"><a href="javascript:void(0)" onclick="del_goods_image(-1,this)"><img src="/resources/style/system/front/default/images/usercenter/del_right.png"  title="删除图片数据" /></a> </span> </li>
                        #end
                        #foreach($img in $obj.goodsPhotosList)
                        #if($velocityCount==1)
                        #set($img2="$!{img.accessory.path}")
                        #set($img2_id="$!img.accessory.id")
                        <li><span class="upload_pictures_bottom_i"><img src="$!{img2}" img_id="$!{img2_id}" goods_id = "$!{img.goodsId}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"><a href="javascript:void(0)" onclick="del_goods_image('0',this)"><img src="/resources/style/system/front/default/images/usercenter/del_right.png"  title="删除图片数据" /></a> </span></li>
                        #end
                        #if($velocityCount==2)
                        #set($img3="$!{img.accessory.path}")
                        #set($img3_id="$!img.accessory.id")
                        <li><span class="upload_pictures_bottom_i"><img src="$!{img3}" img_id="$!{img3_id}" goods_id = "$!{img.goodsId}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"><a href="javascript:void(0)" onclick="del_goods_image('0',this)"><img src="/resources/style/system/front/default/images/usercenter/del_right.png"  title="删除图片数据" /></a> </span></li>
                        #end
                        #if($velocityCount==3)
                        #set($img4="$!{img.accessory.path}")
                        #set($img4_id="$!img.accessory.id")
                        <li><span class="upload_pictures_bottom_i"><img src="$!{img4}" img_id="$!{img4_id}" goods_id = "$!{img.goodsId}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"><a href="javascript:void(0)" onclick="del_goods_image('0',this)"><img src="/resources/style/system/front/default/images/usercenter/del_right.png" title="删除图片数据" /></a> </span></li>
                        #end
                        #if($velocityCount==4)
                        #set($img5="$!{img.accessory.path}")
                        #set($img5_id="$!img.accessory.id")
                        <li><span class="upload_pictures_bottom_i"><img src="$!{img5}" img_id="$!{img5_id}" goods_id = "$!{img.goodsId}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"><a href="javascript:void(0)" onclick="del_goods_image('0',this)"><img src="/resources/style/system/front/default/images/usercenter/del_right.png" title="删除图片数据" /></a> </span></li>
                        #end
                        #end
                      </ul>
                      <ul>
                        <li class="add_img" #if($!obj.goodsPhotosList.size()>=4) style="display:none" #end > <span class="upload_pictures_bottom_w">
                          <input name="imgFile" type="file" id="imgFile" onchange="upload_goods_img()"/>
                          </span> </li>
                      </ul>
                      <input name="imageIds" type="hidden" id="image_ids" />
                      <input name="goodsMainPhotoPath" type="hidden" id="goods_main_img_id" />
                    </div>
                  </div>
                  <!--说明 -->
                  <div class="upload_pictures_statement">
                    <div class="upload_pictures_statement_c"> <img src="/resources/style/system/front/default/images/upload_right.png" /> <span>1、最多可发布 <b style="color:#F00">5</b> 张商品图片<br />
                      2、商品主图下方小图可<b style="color:#F00">拖动</b>以便调整顺序<br />
                      3、支持格式：$!{imageSuffix}<br />
                      4、建议选择尺寸<b style="color:#F00">800x800</b>、大小1M内的图片<br />
                      5、空间不限制大小<br />
                      6、<img src="/resources/style/system/front/default/images/usercenter/del_right.png" /> 表示删除该商品的图片数据
                      </span> </div>
                  </div>
                </div>
              </div>
            </div></td>
        </tr>
      </table>
      <table id="goods_description" style="display:none" width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail">
        <tr>
          <td colspan="2" class="tableh1">详情描述</td>
        </tr>
        #foreach($property in $goods_class.goodsTypeProperty)
        <tr>
          <td align="right" valign="top">$!{property.name}：</td>
          <td><select name="property_$!{property.id}" id="property_$!{property.id}">
              <option value="">请选择...</option>
 			  #foreach($info in $CommUtil.splitByChar("$!property.value",","))
              <option value="$!info">$!info</option>
			  #end
            </select></td>
        </tr>
        #end
        <tr>
          <td align="right" valign="top" style="width:95px;">商品描述： </td>
          <td id="detail_td_web"><div style="width:861px; float:left;">
              <div class="detail_td_web_nav">
                <div class="addphoto_c"><a id="detail_web" class="this" href="javascript:void(0);" onclick="switch_detail_editor('web');">电脑端</a></div>
                <div class="addphoto_c"><a id="detail_app" href="javascript:void(0);" onclick="switch_detail_editor('app');">手机端</a></div>
              </div>
              <div id="goods_details_div_web" class="addphoto_c_textarea">
                <textarea name="goodsDetails" style="width:100%;height:400px;visibility:hidden;" id="goods_details_web">$!obj.goodsDetails</textarea>
              </div>
              <div id="goods_details_div_app" style="display:none; float:left;">
                <textarea name="goodsDetailsMobile" style="width:100%;height:400px;visibility:hidden;" id="goods_details_app">$!obj.goodsDetailsMobile</textarea>
              </div>
              <div id="goods_details_div_app_content" class="goods_details_div_app_right" style="display:none;">
                <li>手机端商品描述说明：</li>
                <li>1.手机端商品描述用于手机app，描述应该符合手机用户的使用场景。</li>
                <li>2.由于手机端的特殊性，建议只使用图片和文字来描述您的商品，并合理安排您的图片的数量和大小。</li>
              </div>
            </div>
            <script>
              function switch_editor_photo(obj){
			  var album_id = jQuery(obj).attr("album_id");
				jQuery.post("$!webPath/admin/goods_img.htm",{"type":"goods_detail_album","album_id":album_id},function(text){
				   jQuery(".editor_photo_detail").empty();
			  	   jQuery(".editor_photo_detail").append(text);
			    },"text");
				jQuery(".editor_photo_detail").show();
		   }


		   		function switch_editor_album(mark){
				 var dis=jQuery(".editor_photo_detail").css("display");
						  if(dis=="none" || mark=="album_list"){
							jQuery.post("$!webPath/admin/goods_album.htm",{"type":"goods_detail_album","ajax_type":".editor_photo_detail"},function(text){
							   jQuery(".editor_photo_detail").empty();
							   jQuery(".editor_photo_detail").append(text);
							},"text");
							jQuery(".editor_photo_detail").show();
						  }else{
							jQuery(".editor_photo_detail").hide();
						  }
			 }
           </script>
            <div class="photoimg" style="width:100%; float:left;">
              <div class="addphoto_b"><a href="javascript:void(0);" onclick="switch_editor_album('');">插入相册图片</a></div>
              <div class="editor_photo_detail" style="display:none;"> </div>
            </div></td>
        </tr>
      </table>
      <table id="goods_pack" style="display:none;" width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail">
        <tr>
          <td colspan="2" class="tableh1">包装清单</td>
        </tr>
        <tr>
          <td align="right" valign="top">清单详情：</td>
          <td><textarea name="packDetails" cols="140" rows="10"  style="resize:none" id="pack_details">$!obj.packDetails</textarea></td>
        </tr>
        <tr>
          <td align="right" valign="top">售后保障：</td>
          <td><textarea name="goodsService"   cols="140" rows="10"  style="resize:none" id="goods_service">$!obj.goodsService</textarea></td>
        </tr>
      </table>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail" id="goods_spec" style="display:none" >
        <tr>
          <td colspan="2" class="tableh1">特殊商品</td>
        </tr>
        #if(!$!obj)
        <tr>
          <td width="95" align="right" valign="top">F码商品：</td>
          <td class="sptable"><label>
              <input name="fSaleType" type="radio" id="f_sale_type" value="1"  />
              是 </label>
            <label>
              <input type="radio" name="fSaleType" id="f_sale_type" value="0" checked="checked"/>
              否 </label></td>
        </tr>
        <tr>
          <td align="right" valign="top">F码前缀：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="fCodeProfix" type="text" id="f_code_profix" />
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">F码数量：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="fCodeCount" type="text" id="f_code_count" />
            </span></td>
        </tr>
        <script>
		  function f_code_show(){
		    jQuery("#f_code_list").show();
			jQuery("#f_code_no_list").hide();
			jQuery("a[id=f_code_show]").hide();
			jQuery("a[id=f_code_hide]").show();
		  }
		  function f_code_hide(){
		    jQuery("#f_code_list").hide();
			jQuery("#f_code_no_list").show();
			jQuery("a[id=f_code_show]").show();
			jQuery("a[id=f_code_hide]").hide();
		  }
		  </script>
        #if($!obj.goodsFCode)
        <tr>
          <td align="right" valign="top">F码列表<a href="javascript:void(0);" onclick="f_code_show();" id="f_code_show">[+]</a> <a id="f_code_hide" style="display:none;" href="javascript:void(0);" onclick="f_code_hide();">[-]</a>：</td>
          <td class="sptable"><div class="presell" id="f_code_no_list"><a href="javascript:void(0);" onclick="f_code_show();">点击打开F码列表信息</a></div>
            <div class="presell" id="f_code_list" style="display:none;">
              <ul>
                #foreach($f_map in $CommUtil.Json2List("$!obj.goodsFCode"))
                <li><i>F码：</i><span>$f_map.get("code")</span><b>状态 : #if($f_map.get("status")==0)未使用#else已使用#end</b></li>
                #end
              </ul>
            </div></td>
        </tr>
        #end
        <tr>
          <td align="right" valign="top">预售商品：</td>
          <td class="sptable"><label>
              <input name="advanceSaleType" type="radio" id="advance_sale_type" value="1" />
              是 </label>
            <label>
              <input type="radio" name="advanceSaleType" id="advance_sale_type" value="0" checked="checked" />
              否 </label></td>
        </tr>
        <tr>
          <td align="right" valign="top">发货时间：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="advanceDate" type="text" id="advance_date" value="$!CommUtil.formatShortDate($!obj.advanceDate)" />
            </span></td>
        </tr>
        #else
        #set($status="")
        #if($!obj.activityStatus==1 ||$!obj.activityStatus==2)
        #set($status="商城促销活动")
        #end
        #if($!obj.groupBuy==2)
        #set($status="团购活动")
        #end
        #if($!obj.combinStatus==1)
        #set($status="组合销售活动")
        #end
        #if($!obj.orderEnoughGiveStatus==1)
        #set($status="满就送活动")
        #end
        #if($!obj.enoughReduce==1)
        #set($status="满就减活动")
        #end
        #if($!status=="")
        <tr>
          <td width="95" align="right" valign="top">F码商品：</td>
          <td class="sptable"><label>
              <input name="fSaleType" type="radio" id="f_sale_type" value="1"  />
              是 </label>
            <label>
              <input type="radio" name="fSaleType" id="f_sale_type" value="0" checked="checked"/>
              否 </label></td>
        </tr>
        <tr>
          <td align="right" valign="top">F码前缀：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="fCodeProfix" type="text" id="f_code_profix" />
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">F码数量：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="fCodeCount" type="text" id="f_code_count" />
            </span></td>
        </tr>
        <script>
                  function f_code_show(){
                    jQuery("#f_code_list").show();
                    jQuery("#f_code_no_list").hide();
                    jQuery("a[id=f_code_show]").hide();
                    jQuery("a[id=f_code_hide]").show();
                  }
                  function f_code_hide(){
                    jQuery("#f_code_list").hide();
                    jQuery("#f_code_no_list").show();
                    jQuery("a[id=f_code_show]").show();
                    jQuery("a[id=f_code_hide]").hide();
                  }
                  </script>
        <tr>
          <td align="right" valign="top">F码列表<a href="javascript:void(0);" onclick="f_code_show();" id="f_code_show">[+]</a> <a id="f_code_hide" style="display:none;" href="javascript:void(0);" onclick="f_code_hide();">[-]</a>：</td>
          <td class="sptable"><div class="presell" id="f_code_no_list"><a href="javascript:void(0);" onclick="f_code_show();">点击打开F码列表信息</a></div>
            <div class="presell" id="f_code_list" style="display:none;">
              <ul>
                #foreach($f_map in $CommUtil.Json2List("$!obj.goodsFCode"))
                <li><i>F码：</i><span>$f_map.get("code")</span><b>状态 : #if($f_map.get("status")==0)未使用#else已使用#end</b></li>
                #end
              </ul>
            </div></td>
        </tr>
        <tr>
          <td align="right" valign="top">预售商品：</td>
          <td class="sptable"><label>
              <input name="advanceSaleType" type="radio" id="advance_sale_type" value="1" />
              是 </label>
            <label>
              <input type="radio" name="advanceSaleType" id="advance_sale_type" value="0" checked="checked" />
              否 </label></td>
        </tr>
        <tr>
          <td align="right" valign="top">发货时间：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="advanceDate" type="text" id="advance_date" value="$!CommUtil.formatShortDate($!obj.advanceDate)" />
            </span></td>
        </tr>
        #else
        <tr>
          <td align="right" valign="top"></td>
          <td class="sptable">该商品已经参加$!{status}，不可编辑为F码商品或预售商品</td>
        </tr>
        #end

        #end
      </table>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail" id="goods_format" style="display:none" >
        <tr>
          <td colspan="2" class="tableh1">商品版式</td>
        </tr>
        <tr>
          <td width="95" align="right" valign="top">顶部版式：</td>
          <td class="sptable"><span>
            <select name="goodsTopFormatId" id="goods_top_format_id">
              <option value="">请选择...</option>
                #foreach($gf in $gfs)
                  #if($!gf.gfType==0)
              <option value="$!gf.id">$!gf.gfName</option>
                  #end
                #end
            </select>
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">底部版式：</td>
          <td class="sptable"><span>
            <select name="goodsBottomFormatId" id="goods_bottom_format_id">
              <option value="">请选择...</option>
                #foreach($gf in $gfs)
                  #if($!gf.gfType==1)
              <option value="$!gf.id">$!gf.gfName</option>
                  #end
                #end
            </select>
            </span></td>
        </tr>
      </table>
      <table id="goods_other" style="display:none" width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail">
        <tr>
          <td colspan="2" class="tableh1">其他信息</td>
        </tr>
        <tr>
          <td align="right" width="95" valign="middle">商品品牌：</td>
          <td>
          <input type="text" style="line-height:24px;" name="nope" id="nope" placeholder="请选择" maxlength="40" />
          	<span id="ck" style="color:red;"></span>
          <input type="hidden" name="goodsBrandId" id="goodsBrandId"/>
		 <span> 
            <div class="field" style="float:none;">
               
               
            </div>

		</span> 
            </td>
        </tr>
        <tr>
          <td width="95" align="right" valign="top">商品重量：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goodsWeight" type="text" id="goods_weight" value="$!obj.goodsWeight" />
            </span> <span class="hui2"> 单位：千克(Kg) </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品体积：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goodsVolume" type="text" id="goods_volume" value="$!obj.goodsVolume" />
            </span> <span class="hui2"> 单位：立方米(m³) </span></td>
        </tr>
        <tr>
          <td rowspan="2" align="right" valign="middle">物流运费：</td>
          <td><label>
              <input name="goodsTransfee" type="radio" id="goods_transfee" value="1" #if($!obj.goodsTransfee==1) checked="checked" #end />
              商家承担运费</label></td>
        </tr>
        <tr>
          <td><label>
              <input name="goodsTransfee" type="radio" id="goods_transfee" value="0" #if($!obj.goodsTransfee==0) checked="checked" #end />
              买家承担运费</label>
            <script>
			jQuery(document).ready(function(){
			   jQuery(":radio[id=transport_type]").click(function(){
				   var val=jQuery(this).val();
				   if(val==0){
				     jQuery("#transport_template_select").show();
					 jQuery("#mail_trans_fee").attr("readonly","readonly");
					 jQuery("#express_trans_fee").attr("readonly","readonly");
					 jQuery("#ems_trans_fee").attr("readonly","readonly");
				   }else{
				     jQuery("#transport_template_select").hide();
					 jQuery("#mail_trans_fee").removeAttr("readonly");
					 jQuery("#express_trans_fee").removeAttr("readonly");
					 jQuery("#ems_trans_fee").removeAttr("readonly");
					 $("#transport_id").val("");
				   }
				});
			   #if($obj.transportId)
			     jQuery(":radio[id=transport_type][value=0]").attr("checked","checked");
				 jQuery("#transport_template_select").show();
			   #else
			     jQuery(":radio[id=transport_type][value=1]").attr("checked","checked");
				 jQuery("#transport_template_select").hide();
			   #end
			   #if($!obj.goodsTransfee==0)
			      jQuery("#buyer_transport_info").show();
			   #end
			});
			</script>
            <div id="buyer_transport_info" style=" display:none;width:80%; background:#F8F8F8; border:1px solid #CCC; margin-top:10px;padding-left:20px;">
              <ul style="line-height:30px;">
                <li>
                  <label>
                    <input name="transportType" type="radio" id="transport_type" value="0" #if($!obj.transportId) checked="checked" #end />
                    使用运费模板</label>
                  <div id="transport_template_select" style="padding-left:30px;">
                    <input type="hidden" value="$!obj.transportId" name="transportId" id="transport_id" />
                    <span style="color:#06C;" id="transport_template_name">$!{obj.transport.transName}</span> <span style="display:block; width:70px; height:28px; text-align:center; border:#CCC solid 1px;"> <a href="javascript:void(0);" dialog_uri="$!webPath/admin/goods_transport.htm?" dialog_title="选择运费模板" dialog_width="600" dialog_height="500" dialog_id="transport_template_frm">选择模板</a></span> </div>
                </li>
                <li>
                  <label>
                    <input  type="radio" name="transportType" id="transport_type" value="1" #if(!$!obj.transportId) checked="checked" #end />
                    固定运费</label>
                  <!-- 平邮
                  <input name="mailTransFee" type="text" id="mail_trans_fee" value="$!CommUtil.null2Float($!obj.mailTransFee)" size="10" />
                  元, -->快递
                  <input name="expressTransFee" type="text" id="express_trans_fee" value="$!CommUtil.null2Float($!obj.expressTransFee)" size="10" />
                  元<!-- ,EMS
                  <input name="emsTransFee" type="text" id="ems_trans_fee" value="$!CommUtil.null2Float($!obj.emsTransFee)" size="10" />
                  元  --></li>
              </ul>
            </div></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品发布：</td>
          <td class="prorelease"><span>
            <label>
              <input name="goodsStatus" id="goods_status" type="radio" value="0" checked="checked" />
              &nbsp;立即发布 </label>
            </span> <span>
            <label>
              <input name="goodsStatus" id="goods_status" type="radio" value="1" />
              &nbsp;放入仓库 </label>
            </span> <span>
            <label>
<!--               <input name="goodsStatus" id="goods_status" type="radio" value="2" /> -->
<!--               &nbsp;定时发布 </label> -->
            </span> <span style="display:none;" id="publish_info">
            <input type="text" name="publishDay" id="publish_day" />
            日
            <select name="publishHour" id="publish_hour">
              <option value="0">00</option>
              <option value="1">01</option>
              <option value="2">02</option>
              <option value="3">03</option>
              <option value="4">04</option>
              <option value="5">05</option>
              <option value="6">06</option>
              <option value="7">07</option>
              <option value="8">08</option>
              <option value="9">09</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="21">21</option>
              <option value="22">22</option>
              <option value="23">23</option>
            </select>
            时
            <select name="publishMin" id="publish_min">
              <option value="0">0分</option>
              <option value="15">15分</option>
              <option value="30">30分</option>
              <option value="45">45分</option>
            </select>
            分</span></td>
        </tr>
         <tr>
          <td width="95" align="right" valign="top">商品权重：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="sortWeight" type="text" id="sort_weight" value="$!obj.sortWeight" />
            </span></td>
        </tr>
        <tr>
        <td align="right" valign="top">标签：</td>
        <td class="sptable"><span class="texttable">
            <textarea name="goodsTarget" cols="" rows="" id="goods_target">$!obj.goodsTarget</textarea>
            </span> <span class="hui2 noteswidth">标签以","号隔开。</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">SEO关键字：</td>
          <td class="sptable"><span class="tabtxt1 size1">
            <input name="seoKeywords" type="text" id="seo_keywords" value="$!obj.seoKeywords" />
            </span> <span class="hui2 noteswidth">SEO关键字 (keywords) 出现在商品详细页面头部的 Meta 标签中，
            用于记录本页面商品的关键字，多个关键字间请用半角逗号 "," 隔开。</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">SEO描述：</td>
          <td class="sptable"><span class="texttable">
            <textarea name="seoDescription" cols="" rows="" id="seo_description">$!obj.seoDescription</textarea>
            </span> <span class="hui2 noteswidth">SEO描述 (Description) 出现在商品详细页面头部的 Meta 标签中，
            用于记录本页面商品的的描述，建议80字左右，应该是该商品的最精确的简短的概述。</span></td>
        </tr>
      </table>
       <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail" id="goods_idximg" style="display:none" >
     			<tr>
     				<td>
     						<a href="javascript:;"><input type="file" id="uploadImg" /></a>     						
     						<div class="container" id="imgCrop">
								    <div class="content">
								        <div class="component">
								            <div class="overlay">
								                <div class="overlay-inner">
								                </div>
								            </div>
								            <img class="resize-image" src="" alt="image for resizing">
								            <a class="btn-crop js-crop">Crop<img class="icon-crop" src="http://tympanus.net/Tutorials/ImageResizeCropCanvas/img/crop.svg">
								            </a>
								        </div>
								    </div>
								</div>
								
								#if($!obj.goodsIndexPhotoPath)
									<img src="$!obj.goodsIndexPhotoPath" id="previewImg"/>
								#else
									<img src="" id="previewImg" style="display:none"/>
								#end
								<input type="hidden" id="goodsIndexPhotoPath" name="goodsIndexPhotoPath"  value="$!obj.goodsIndexPhotoPath"/>
     				</td>
     			</tr>
       </table>
      
      <script>
      function upload_goods_img2(){
	      	jQuery(".add_img").removeClass("add_img").addClass("add_loading");
	      	var base64img=$("#previewImg").attr("src");
	      	jQuery.ajaxFileUpload({url:'$!webPath/uploadBase64.htm',
      								  dataType:'text',
      								  fileElementId:['previewImg'],
      								  fileFilter:"$!imageSuffix1",
      								  success:function(data){
      									var json = eval('(' + data + ')'); 
      									jQuery(".add_loading").removeClass("add_loading").addClass("add_img");
      				 					draw_goods_img(json.url, '-1');
      								  },
      		});
      }
	  

	  function sumitImageFile(base64Codes){	      
	      var formData = new FormData();   //这里连带form里的其他参数也一起提交了,如果不需要提交其他参数可以直接FormData无参数的构造函数
	      
	      //convertBase64UrlToBlob函数是将base64编码转换为Blob
	      formData.append("imgFile",convertBase64UrlToBlob(base64Codes));  //append函数的第一个参数是后台获取数据的参数名,和html标签的input的name属性功能相同
	      
	      //ajax 提交form
	      $.ajax({
	          url :"$!webPath/file/upload.htm?module=goods/index/pc",
	          type : "POST",
	          data : formData,
	          dataType:"json",
	          processData : false,         // 告诉jQuery不要去处理发送的数据
	          contentType : false,        // 告诉jQuery不要去设置Content-Type请求头	          
	          success:function(data){
	            if(data.error=="0"){
	            	$("#goodsIndexPhotoPath").val(data.url);
	            }
	          }
	        
	      });
	  }

	  
      function convertBase64UrlToBlob(urlData){
    	    
    	    var bytes=window.atob(urlData.split(',')[1]);        //去掉url的头，并转换为byte
    	    
    	    //处理异常,将ascii码小于0的转换为大于0
    	    var ab = new ArrayBuffer(bytes.length);
    	    var ia = new Uint8Array(ab);
    	    for (var i = 0; i < bytes.length; i++) {
    	        ia[i] = bytes.charCodeAt(i);
    	    }

    	    return new Blob( [ab] , {type : 'image/png'});
    	}
      </script>
      
      
      <span class="submittable" style="margin-left:125px; margin-top:20px; float:left">
      <input name="" type="submit" value="提交"/>
      <input name="goodsSession" type="hidden" id="goods_session" value="$!goodsSession" />
      </span>
    </form>
  </div>
</div>
<input type="hidden" id="webpath" value="$!webPath"/>
<div id="imgUploadCon">			
	<div class="title">
		<a href="javascript:;" class="close">×</a>
		<span>上传图片</span>
	</div>
	<div class="local-image-region">
        <div class="title">本地图片：</div>
        <div class="content">
            <div class="js-image-preview-region"><ul class="upload-local-image-list image-list ui-sortable">
            	
            </ul></div>
            <div class="js-add-local-attachment add-local-image-button pull-left" style="display: block;">
                +
         <input id="upload_input_dialog_file" name= "upload_input_dialog_file" type="file" value="添加 +" class="js-local-file upload_input_dialog"
         
         accept="image/gif, image/jpeg, image/png" mark="upload_input_dialog" />

            </div>
            <input type="hidden" id="tempURL" value="" />
            <div class="c-gray" style="clear: both; padding-top: 20px;">
                仅支持jpg、gif、png三种格式, 大小不超过1 MB
            </div>
        </div>
    </div>
       <div class="modal-footer clearfix">
	    <div class="text-center">
	        <button class="ui-btn js-confirm ui-btn-disabled" data-loading-text="正在上传...">确认</button>
	        <input type="hidden" id="spec_pic" value="" />
	    </div>
	</div>
</div>

<script src="$!webPath/resources/js/spec.js?v=0717"></script>
#parse("/result/key_word_utils.html")
</body>
</html>
