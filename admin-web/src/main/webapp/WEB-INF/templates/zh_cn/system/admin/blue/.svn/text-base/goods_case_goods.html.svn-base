<link href="$!webPath/resources/js/jquery-select2/3.4/select2.min.css"  rel="stylesheet" type="text/css"/>
<script src="$!webPath/resources/js/jquery-select2/3.4/select2.min.js"></script>
<script src="$!webPath/resources/js/jquery.shop.common.js"></script>
<style>
.floor_pro{height:162px}
</style>
<script>
jQuery(document).ready(function(){
   jQuery("#floor_goods_info").sortable({containment:"#floor_goods_info",opacity:0.9,cursor:"crosshair"});
   jQuery("#floor_goods_info").disableSelection();
   jQuery("#gc_id").load("$!webPath/admin/goods_case_gc.htm", function() {
	   $("#gc_id").select2();
   });
   
});
function ajaxPage(url,page,obj){
 jQuery.ajax({type:'POST',url:url,data:{"currentPage":page},
			  success:function(data){
					jQuery("#goods_case_goods_list").empty().append(data);
				} 
			});
}

function gotoPage(page){
	 jQuery.ajax({type:'POST',url:'$!webPath/admin/goods_case_goods_load_all.htm',
		 data:{"currentPage":page,
			 gcId:$('#gc_id').val(),goodsName:$('#goods_name').val()},
				  success:function(data){
						jQuery("#goods_case_goods_list").empty().append(data);
					} 
				});
	}
	
function goods_case_goods_load(){
  var gc_id=jQuery("#gc_id").val();
  var goods_name=jQuery("#goods_name").val();
  jQuery.ajax({type:'POST',url:'$!webPath/admin/goods_case_goods_load_all.htm',data:{"gcId":gc_id,"goodsName":goods_name},
			  success:function(data){
					jQuery("#goods_case_goods_list").empty().append(data);
				}
			});
}
function goods_list_set(obj){
	  var img=jQuery(obj).attr("img_uri");
	  var goods_id=jQuery(obj).attr("goods_id"); 
	  var price=jQuery(obj).attr("price");
	  var goods_name=jQuery(obj).attr("goods_name");
	  var count=jQuery(".floor_box_pls ul").length;
	  var add=0;
	  jQuery(".floor_box_pls ul").each(function(){
	     if(jQuery(this).attr("goods_id")==goods_id){
		   alert("已经存在该商品");
		   add=2;
		 }
	  });

	  var idximg=jQuery(obj).attr("idxImg");

	  if(idximg==""&& jQuery("#otherCase").val()=="0"){
		  alert("首页推荐图片为空，请先上传编辑首页图片");
		  location.href="$!webPath/admin/goods_self_edit.htm?id="+goods_id;
	  }else{
		  if(add==0){
			  var s="<ul ondblclick='jQuery(this).remove();' class='floor_pro' style=' margin-left:23px;'  goods_id='"+goods_id+"'><li class='floor_pro_img'><img src='"+img+"' width='100' height='100' /></li><li>￥"+price+"</li><li class='floor_pro_name'>"+goods_name+"</li></ul>";
			  jQuery(".floor_box_pls").append(s);
			  }
	  }
	  
}
function save_form(){
 var ids=""; 
 jQuery(".floor_box_pls ul").each(function(){
   ids=ids+","+jQuery(this).attr("goods_id"); 
 });
 if(ids==""){
	 alert("请选择商品！");
	 }else{	 
	 jQuery("#add_goods").attr("dialog_uri","$!webPath/admin/goods_case_goods.htm?goods_ids="+ids);
	 var count=jQuery(".floor_box_pls ul").length;
	 jQuery("#goods_count").html("共"+count+"件商品");
	 jQuery("#case_content").val(ids);
	 jQuery("#case_goods").remove();	 
		 }
}
</script>
<form action="$!webPath/admin/goods_case_goods_save.htm" method="post" id="theForm">
<input type="hidden" id="otherCase" value="$!otherCase">
<div class="box_floor">
  <div class="box_floor_six">
    <div class="box_floor_class">
      <input name="id" type="hidden" id="id" value="$!{obj.id}">
      <input type="hidden" name="ids" id="ids">
      <input type="hidden" name="old_ids" id="old_ids" value="$!{obj.goodsIds}">
    </div>
    <span class="floor_choose">已选橱窗商品：</span>
    <div class="box_floor_prodel" style="width:95%"> <em class="floor_warning">注释：显示时按照添加顺序显示。双击删除已选商品信息，按下鼠标拖动商品次序</em>
      <div class="floor_box_pls" id="floor_goods_info" style="min-height:120px;max-height:480px; width:100%; overflow-x:auto;">
      #if($!goods_list)
	    #foreach($obj in $goods_list)
			  	#if($!obj.goodsIndexPhotoPath && $!obj.goodsIndexPhotoPath != "")              
			   			#set($img="$!{obj.goodsIndexPhotoPath}")
			    #elseif($!obj.goodsMainPhotoPath && $!obj.goodsMainPhotoPath != "")
	   					#set($img="$!{obj.goodsMainPhotoPath}")
			    #else
			    		#set($img="$!config.goodsImage")
			    #end
			 <ul ondblclick="jQuery(this).remove();" class="floor_pro" style=" margin-left:23px;"
			 #if($!obj.IsJuanpi==1)
			 	goods_id="jp_$!obj.id"
			 #else
			 	goods_id="$!obj.id"
			 #end
			 
			 >
	      			 <input type="hidden" name="$!obj.goodsIndexPhotoPath" id="$!obj.goodsIndexPhotoPath">
					 <li class="floor_pro_img"><img src="$!{img}" width="100" height="100" /></li>
					 <li>￥$!obj.goodsShowPrice</li>
					 <li class="floor_pro_name" style="height:35px">$!obj.goodsName</li>
			 </ul>
		#end
	#end
        </div>
    </div>
    <span class="floor_choose">选择要展示的商品：</span>
    <div class="floor_choose_box"> 
		<span class="floor_search_sp"><b>选择分类：</b>
			      <select name="gcId" id="gc_id" class="gf_select" style="width: 220px;">
			      		<option value="">请选择商品分类...</option>
			      </select>
		</span> 
		<span class="floor_search_sp" style="margin-left:5px;"><b>商品名称：</b>
				<input name="goodsName" type="text" id="goods_name" class="gf_goods_name"/>
				<input type="button"  class="floor_sear_btn" value="搜索" onclick="goods_case_goods_load();" style="cursor:pointer; margin-top:2px;" />
		</span> 
		<em class="floor_warning">注释：点击商品加入橱窗</em>
		<div id="goods_case_goods_list"></div>
    </div>
  </div>
  <!--图片开始-->
  <div class="submit">
    <input type="button" value="保存" onclick="save_form();" />
  </div>
</div>
</form>
<style>

</style>