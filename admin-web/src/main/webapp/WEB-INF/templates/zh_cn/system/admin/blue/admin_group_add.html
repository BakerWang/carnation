<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
</head>
<link href="$!webPath/resources/style/system/manage/$!{config.websiteCss}/template.css"  rel="stylesheet" type="text/css"/>
<script src="$!webPath/resources/js/jquery-1.6.2.js"></script>
<script src="$!webPath/resources/js/jquery.shop.common.js"></script>
<script src="$!webPath/resources/js/jquery.validate.min.js"></script>
<script src="$!webPath/resources/js/jquery.poshytip.min.js"></script>
<script>
jQuery(document).ready(function(){
  	jQuery("#theForm").validate({
      rules:{
    	       groupName:{
      	       required :true,
      	       remote:{
      		        url: "$!webPath/verify_user_group_name.htm",     //后台处理程序
                  type: "post",               //数据发送方式
                  dataType: "json",           //接受数据格式   
                  data: {                     //要传递的数据
                        "groupName": function(){return jQuery("#groupName").val();},
      				          "id":function(){return jQuery("#id").val()}
      		        }
    			     }
    	       },
      },
    	messages:{
    	  userName:{required:"角色名不能为空",remote:"该角色名已经存在"},
    	}
    });


  //
  jQuery(":checkbox[id^=rg_ck_]").click(function(){
    var val=jQuery(this).attr("id").substring(6);
	  var ck=jQuery(this).attr("checked");
    var expr="ul[id=rg_"+val+"] :checkbox";
  	 if(ck=="checked"){
  	   jQuery(expr).attr("checked",true);
  	 }
     else{
       jQuery(expr).attr("checked",false);
     }
  });

});

function saveForm(){
  var roles="";
  jQuery(":checkbox:checked").each(function(){
     if(jQuery(this).val()!=""){
       roles=roles+","+jQuery(this).val();
	 }
  });
  jQuery("#role_ids").val(roles);
  jQuery("#theForm").submit();
}

</script>
<body>
<form name="theForm" id="theForm" action="$!webPath/admin/admin_group_save.htm" method="post">

<input id="id" name="id" type="hidden" value="$!obj.id"/>
<input name="list_url" type="hidden" id="list_url" value="$!webPath/admin/admin_group_list.htm" />
<input name="add_url" type="hidden" id="add_url" value="$!webPath/admin/admin_group_add.htm" />
<input name="role_ids" type="hidden" id="role_ids" />

<div class="cont">
  <h1 class="seth">角色管理</h1>
  
  <div class="nav_list">
    <ul>
        <li><a href="$!webPath/admin/admin_list.htm"  ><b>管理员列表</b></a></li>
          <li><a href="$!webPath/admin/admin_add.htm"><b>管理员新增</b></a></li>
          <li><a href="$!webPath/admin/admin_group_list.htm"><b>角色列表</b></a></li>
          <li><a href="$!webPath/admin/admin_group_add.htm" class="this"><b>#if($!op == "add") 角色新增#else 角色编辑 #end </b></a></li>     
          <li><a href="$!webPath/admin/admin_log_list.htm"><b>系统日志</b></a></li>
          <li><a href="javascript:void(0);" onclick="if(confirm('执行权限初始化将会初始化所有系统权限及用户权限，且不可恢复，是否继续？'))window.location.href='$!webPath/admin/init_role.htm'" class="add_btn"><b class="add_btn_b">权限初始化</b></a></li>
    </ul>
  </div>
  
  <div class="edit">

    <div class="editul setcont">
      <ul class="set3">
        <li ><strong class="sred">*</strong>角色名</li>
        <li ><span class="webname">
          <input name="groupName" type="text" id="groupName" value="$!obj.groupName"/>
          </span></li>
      </ul>
    </div>

    	#foreach($rg in $rgs)        
           <div class="spec_sports_box">
              <ul class="spec_sports_left" >
                <li>
                  <label>
                     <b class="spec_check"><input name="rg_ck_$!rg.id" type="checkbox" id="rg_ck_$!rg.id" value="" /> </b>
                     <b> $!rg.name</b>
                  </label>
                </li>
              </ul>
              <ul class="spec_sports" id="rg_$!rg.id">
            	  #foreach($role in $rg.roles)
                    #if($role.display)
            		      #set($r=0)
                		  #foreach($info in $!obj.roles)
                		    #if($!info.id==$!role.id)
                			   #set($r=1)
                			  #end
                		  #end
                  		<li>
                    		<label>
                          <b class="spec_check2">
                            <input name="role_$!role.id" type="checkbox" id="role_$!role.id" value="$!role.id" 
                              #if($!r==1) checked="checked"#end/>
                          </b>　 
                          <em>$!role.roleName</em>
                        </label>
                  		</li>
            		    #end
            	  #end
              </ul>              
           </div>
    	#end
  </div>

  <div class="submit">
    <input name="save" type="button" id="save" value="保存" onclick="saveForm();"/>
  </div>

</div>

</form>
</body>
</html>
