<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<link href="$!webPath/resources/style/system/manage/$!{config.websiteCss}/template.css"  rel="stylesheet" type="text/css"/>
<link href="$!webPath/resources/style/common/css/jquery.bigcolorpicker.css" type="text/css" rel="stylesheet" />
<script src="$!webPath/resources/js/jquery-1.6.2.js"></script>
<script src="$!webPath/resources/js/jquery.validate.min.js"></script>
<script src="$!webPath/resources/js/jquery.bigcolorpicker.js"></script>
<script>
jQuery(document).ready(function(){
//设置颜色
jQuery("#gc_color").bigColorpicker(function(el,color){
	jQuery(el).val(color);
	});	
//设置默认状态以及判断初始显示状态
	var state = jQuery("#display").val();
	if(state==""){
		jQuery("#display").val("true");
		jQuery("#displayOff").hide();
	}else{
		 if(state=="true"){
			jQuery("#displayOff").hide();
		}else{
			jQuery("#displayOn").hide();
		}
	}
	
	var state1 = jQuery("#recommend").val();
	if(state1==""){
		jQuery("#recommend").val("true");
		jQuery("#recommendOff").hide();
	}else{
		 if(state1=="true"){
			jQuery("#recommendOff").hide();
		}else{
			jQuery("#recommendOn").hide();
		}	
	}	
//
 	//改变系统提示的样式
  jQuery("span .w").mousemove(function(){
	var id=jQuery(this.parentNode).attr("id");
	if(id="nothis"){
	   jQuery(this.parentNode).attr("id","this")
	}
  }).mouseout(function(){
     var id=jQuery(this.parentNode).attr("id");
	 if(id="this"){
	   jQuery(this.parentNode).attr("id","nothis")
	 }
  });
jQuery("#pid").val("$!obj.parentId");
jQuery("#goodsTypeId").val("$!obj.goodsTypeId");
#if($!obj.goodsTypeId)
var type_id = $!obj.goodsTypeId;
jQuery("#goodsTypeBrand").show();
			jQuery.ajax({type:'POST',
					url:'$!webPath/admin/goods_goodsType_brand.htm',
					data:{"type_id":type_id},
					success:function(data){
						var list = jQuery.parseJSON(data);
						jQuery("#goodsTypeBrand").find("span:first").empty();
						jQuery.each(list,function(index,obj){
							jQuery("#goodsTypeBrand").find("span:first").append("<label class='type_brand'><input type='checkbox' mark='brand' value='"+obj.id+"'/>&nbsp;<b>"+obj.name+"</b></label>&nbsp;&nbsp;");
						}); 
						//设置已选中
							#if($!gbs.size()>0)
								#foreach($gb in $gbs)
								jQuery("#goodsTypeBrand").find("input[type='checkbox'][value='"+$!{gb.id}+"']").attr("checked",true);
								#end
							#end	
					}
					});	
#end
//

jQuery.validator.addMethod("verify",function(value,element){
		var re =  /^([0-9a-zA-Z]|[\u4E00-\u9FA5]|[.]{1}[0-9])+$/;
        if(re.test(jQuery("#commissionRate").val())){			
			return true;
		  } 
		  else {
		    return false;
			  }		  
});
  jQuery("#theForm").validate({
    rules:{
	  className:{
	    required :true,
	     remote:{
		    url: "$!webPath/admin/goods_class_verify.htm",     //后台处理程序
            type: "post",               //数据发送方式
            dataType: "json",           //接受数据格式   
            data: {                     //要传递的数据
                  "className": function(){return jQuery("#className").val();},
				  "id":function(){return jQuery("#id").val()},
				  "pid":function(){return jQuery("#pid").val()}
		     }
			}
	  },
	  commissionRate:{required:true,verify:true,max:0.99},
	  guarantee:{digits:true,maxlength:12},
	  sequence:{digits:true}
	 },
	messages:{
	  className:{required:"分类名称不能为空",remote:"该分类已经存在"},
	  commissionRate:{required:"佣金比例不能为空",verify:"请正确输入佣金比例",max:"佣金比例请小于1"},
	  guarantee:{digits:"请正确输入保证金",maxlength:"请正确输入保证金"},
		sequence:{digits:"请输入正整数"}
	},
  });
  //图标
  jQuery("#pid").change(function(){
	 var val = jQuery(this).val();
/* 	  if(val==""){
		 jQuery("#icon").show(); 		 
		 jQuery("#icon_sys_ul").show();
		  jQuery("#goodsTypeBrand").show(); //显示品牌
		  jQuery("#adv_type_ul").show(); //显示广告
		  jQuery("#gc_adv_0").show(); //隐藏广告
		  jQuery("#gc_adv_1").show(); //隐藏广告
		  jQuery("#gc_adv_3").show(); //隐藏广告
		  jQuery("#gc_color_ul").show(); //显示广告
			 jQuery("#icon_acc_ul").show(); 
			 jQuery("#mobile_icon_acc_ul").show(); 
		  }else{ 
		 jQuery("#goodsTypeBrand").hide(); //隐藏品牌
		  jQuery("#adv_type_ul").hide(); //隐藏广告
		  jQuery("#gc_adv_0").hide(); //隐藏广告
		  jQuery("#gc_adv_1").hide(); //隐藏广告
		   jQuery("#gc_adv_3").hide(); //隐藏广告
		  jQuery("#gc_color_ul").hide(); //隐藏广告
		 jQuery("#icon").hide();
		 jQuery("#icon_sys_ul").hide();  
		 jQuery("#icon_acc_ul").hide(); 
		 jQuery("#mobile_icon_acc_ul").hide(); 
			  } */
		  if(val==""){
			  jQuery("#icon_selected").show();
		  }else{
			  jQuery("#icon_selected").hide();
		  }
	  });
  
  jQuery(".icon_sys a").click(function(){
	  jQuery("#iconSys").val(jQuery(this).attr("icon"));
	  jQuery(this).parent().find("a").removeClass("this");
	  jQuery(this).addClass("this");
	  });
   jQuery("input[type='file']").change(function(){
	 jQuery(this).parent().parent().find("input[type='text']").val(jQuery(this).val());
   })
     jQuery("#logoShow").mouseover(function(){								
	    jQuery("#logoImg").css('display','block');
   }).mouseout(function(){
		jQuery("#logoImg").css('display','none');
	});
   jQuery("#mobileLogoShow").mouseover(function(){								
	    jQuery("#mobileLogoImg").css('display','block');
  }).mouseout(function(){
		jQuery("#mobileLogoImg").css('display','none');
	});
   
   jQuery("#clickLogoImg").mouseover(function(){								
	    jQuery("#clickLogoImg").css('display','block');
  }).mouseout(function(){
		jQuery("#clickLogoImg").css('display','none');
	});
   jQuery("#unClickLogoImg").mouseover(function(){								
	    jQuery("#unClickLogoImg").css('display','block');
  }).mouseout(function(){
		jQuery("#unClickLogoImg").css('display','none');
	});
   
	jQuery("#applogoShow").mouseover(function(){								
	    jQuery("#appLogoImg").css('display','block');
   }).mouseout(function(){
		jQuery("#appLogoImg").css('display','none');
	});	
	  jQuery("#logoShow3").mouseover(function(){								
	    jQuery("#logoImg4").css('display','block');
   }).mouseout(function(){
		jQuery("#logoImg4").css('display','none');
	});
#if($!obj.parentId)
jQuery("#icon").hide();	
jQuery("#icon_sys_ul").hide();  
/* jQuery("#icon_acc_ul").hide();
jQuery("#mobile_icon_acc_ul").hide(); */
#end

  //分类广告类型
    jQuery("input[type='radio'][name='adv_type']").change(function(){
	 var val = jQuery(this).attr("value");
	 jQuery("ul[id^=gc_adv_]").hide();
	 if(val==1){
	jQuery("#gc_adv_1").show();
	jQuery("#gc_adv_3").show();
		 }
	if(val==0){
	jQuery("#gc_adv_0").show();	 
		 }
  });


#if($!adv_type)
var val = $!adv_type;
	 jQuery("ul[id^=gc_adv_]").hide();
	 jQuery("ul[id=gc_adv_"+val+"]").show();
 if(val==1){
	jQuery("#gc_adv_1").show();
	jQuery("#gc_adv_3").show();
		 }
	if(val==0){
	jQuery("#gc_adv_0").show();	 
		 }	 
#end

#if($!adv_id)
jQuery("#ap_id").val("$!adv_id");
#end
//分类品牌设置
jQuery("#goodsTypeId").change(function(){
var type_id =jQuery(this).val();
var pid =jQuery("#pid").val();
if(pid==""){
		if(type_id==""){
			jQuery("#goodsTypeBrand").hide();
		}else{
			jQuery("#goodsTypeBrand").show();
			jQuery.ajax({type:'POST',
					url:'$!webPath/admin/goods_goodsType_brand.htm',
					data:{"type_id":type_id},
					success:function(data){
						var list = jQuery.parseJSON(data);
						jQuery("#goodsTypeBrand").find("span:first").empty();
						jQuery.each(list,function(index,obj){
							jQuery("#goodsTypeBrand").find("span:first").append("<label class='type_brand'><input type='checkbox' mark='brand' value='"+obj.id+"'/>&nbsp;<b>"+obj.name+"</b></label>&nbsp;&nbsp;");
						}); 
					}
					});			
		}	
}else{
	jQuery("#goodsTypeBrand").hide();
}


});	



});////

function saveForm(method){
	var gbs_ids = "";
	jQuery(":checkbox[checked=true][mark='brand']").each(function(){
	gbs_ids = gbs_ids+","+jQuery(this).val();
	});
	jQuery("#gbs_ids").val(gbs_ids);
   jQuery("#theForm").submit();
}

//设置显示开关
function displayState(){
	var state = jQuery("#display").val();
	if(state=="true"){
		jQuery("#display").val("false");
		jQuery("#displayOff").show();
		jQuery("#displayOn").hide();
	}else{
		jQuery("#display").val("true");
		jQuery("#displayOff").hide();
		jQuery("#displayOn").show();
	}
}

//设置推荐开关
function recommendState(){
	var state = jQuery("#recommend").val();
	if(state=="true"){
		jQuery("#recommend").val("false");
		jQuery("#recommendOff").show();
		jQuery("#recommendOn").hide();
	}else{
		jQuery("#recommend").val("true");
		jQuery("#recommendOff").hide();
		jQuery("#recommendOn").show();
	}
}
</script>
</head>
<body>
<div class="cont">
  <h1 class="seth">商品分类</h1>
  <div class="nav_list">
    <ul>
      <li> <a href="$!webPath/admin/goods_class_list.htm"><b>管理</b></a> </li>
      <li> <a href="$!webPath/admin/goods_class_add.htm"  #if(!$!edit) class="this" #end><b>新增</b></a></li>
      #if($!edit)
      <li><a href="javascript:void(0);" class="this"><b>编辑</b></a></li>
      #end
    </ul>
  </div>
  <form name="theForm" id="theForm" action="$!webPath/admin/goods_class_save.htm" method="post" enctype="multipart/form-data">
    <input name="id" type="hidden" id="id" value="$!obj.id" />
    <input name="currentPage" type="hidden" id="currentPage" value="$!currentPage" />
    <input name="list_url" type="hidden" id="list_url" value="$!webPath/admin/goods_class_list.htm" />
    <input name="add_url" type="hidden" id="add_url" value="$!webPath/admin/goods_class_add.htm" />
     <input name="iconType" id="type2"  type="radio" checked="checked" style="display: none">
    <div class="edit">
      <div class="setcont editul">
        <ul class="set1">
          <li class="setcont_bg"><strong class="sred">*</strong>分类名称</li>
          <li><span class="webname">
            <input name="className" type="text" id="className" value="$!obj.className" size="40" />
            </span></li>
        </ul>
        <!--鼠标未经过样式-->
        <ul class="set1">
          <li  class="setcont_bg">上级分类</li>
          <li><span>
            <select name="pid" id="pid">
              <option value="">请选择上级商品分类...</option>
			  #foreach($gc in $gcs)
              #if($gc.id != $obj.id)
              <option value="$!gc.id">$!gc.ClassName</option>
              		  #foreach($child in $gc.childs)
                      #if($child.id != $obj.id)
              <option value="$!child.id">&nbsp;&nbsp;&nbsp;&nbsp;$!child.ClassName</option>
                      			 #foreach($c in $child.childs)
                                  #if($c.id != $obj.id)
              <option value="$!c.id">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$!c.ClassName</option>
              					  #end
                                  #end
                      #end
                      #end
              #end
              #end
            </select>
            </span><span id="nothis"><strong class="q"></strong><strong class="w">如果选择上级分类，那么新增的分类则为被选择上级分类的子分类</strong><strong class="c"></strong></span></li>
        </ul>
        <ul class="set1">
          <li  class="setcont_bg">类型</li>
          <li> <span>
            <select name="goodsTypeId" id="goodsTypeId">
              <option value="">请选择...</option>
              
              
		#foreach($gt in $!gts)
          
              
              <option value="$!gt.id">$!gt.name</option>
              
              
		#end  
        
            
            </select>
            </span><span class="use_code"><strong>
            <label>
              <input name="child_link" type="checkbox" id="child_link" value="true" />
              关联类型到下级</label>
            </strong></span><span id="nothis"><strong class="q"></strong><strong class="w">如果当前下拉选项中没有适合的类型，可以去<a href="javascript:void(0);" onclick="window.parent.openURL('url','$!webPath/admin/goods_type_list.htm','main_workspace','goods_type_op','about_goods')" style="color:#fff; background-color:#FF6600; padding:2px 4px; border-radius:4px 4px 4px 4px;">类型管理</a>功能中新增新的类型</strong></span> <strong></strong></li>
        </ul>
        <ul class="set1" id="goodsTypeBrand" style="display:none">
          <li  class="setcont_bg">品牌</li>
          <li> <span style="width:740px;"> </span><span class="use_code"><strong> </strong></span><span id="nothis"><strong class="q"></strong><strong class="w">设置后在首页分类弹出层中顶部显示</strong></span> <strong></strong></li>
        </ul>
        <ul class="set1">
          <li class="setcont_bg">显示</li>
          <li class="webSwitch">
            <input name="display" id="display" type="hidden" value="$!obj.display" />
            <img src="$!webPath/resources/style/system/manage/$!{config.websiteCss}/images/on.jpg" width="61" height="23" id="displayOn" onclick="displayState();" style="cursor:pointer"/> <img src="$!webPath/resources/style/system/manage/$!{config.websiteCss}/images/off.jpg" width="61" height="23" id="displayOff" onclick="displayState();" style="cursor:pointer"/></li>
        </ul>
        <ul class="set1" id="icon_acc_ul"  >
          <li class="setcont_bg">web端图标上传</li>
          <li> <span class="size13" >
            <input name="textfield" type="text" id="textfield1" />
            </span> <span class="filebtn">
            <input name="button" type="button" id="button1" value=""/>
            </span> <span style="float:left;" class="file">
            <input name="iconAcc" type="file" id="iconAcc" class="file-text" size="30"/>
            </span> <span class="preview"> <img src="$!webPath/resources/style/system/manage/blue/images/preview.jpg" width="25" height="25"  id="logoShow" style="cursor:help"/> </span>#if(!$!obj.iconAccId)<span id="nothis"><strong class="q"></strong><strong class="w">暂无图标</strong><strong class="c"></strong></span>#end
            #if($!obj.iconAccId)
            <div class="bigimgpre" id="logoImg" style="display:none; left:380px;"><img src="$!obj.iconAccId"  width="50" height="50" id="logoShow2"/> </div>
            #end </li>
        </ul>
        <ul class="set1" id="mobile_icon_acc_ul" >
          <li class="setcont_bg">移动端图标上传</li>
          <li> <span class="size13" >
            <input name="textfield" type="text" id="textfield1" />
            </span> <span class="filebtn">
            <input name="button" type="button" id="button1" value=""/>
            </span> <span style="float:left;" class="file">
            <input name="mobileIconAcc" type="file" id="mobileIconAcc" class="file-text" size="30"/>
            </span> <span class="preview"> <img src="$!webPath/resources/style/system/manage/blue/images/preview.jpg" width="25" height="25"  id="mobileLogoShow" style="cursor:help"/> </span>#if(!$!obj.mobileIcon)<span id="nothis"><strong class="q"></strong><strong class="w">暂无图标</strong><strong class="c"></strong></span>#end
            #if($!obj.mobileIcon)
            <div class="bigimgpre" id="mobileLogoImg" style="display:none; left:380px;"><img src="$!obj.mobileIcon"  width="50" height="50" /> </div>
            #end </li> 
            <li>	图片尺寸  74*74</li>
        </ul>
        
        <span id="icon_selected" #if($!obj.level!=0) style="display:none" #end>
        <ul class="set1" id="click_icon_acc_ul" >
          <li class="setcont_bg">选中状态图标上传 </li>
          <li> <span class="size13" >
            <input name="textfield" type="text" id="textfield1" />
            </span> <span class="filebtn">
            <input name="button" type="button" id="button1" value=""/>
            </span> <span style="float:left;" class="file">
            <input name="clickIconAcc" type="file" id="clickIconAcc" class="file-text" size="30"/>
            </span> <span class="preview"> <img src="$!webPath/resources/style/system/manage/blue/images/preview.jpg" width="25" height="25"  id="clickLogoShow" style="cursor:help"/> </span>#if(!$!obj.mobileIcon)<span id="nothis"><strong class="q"></strong><strong class="w">暂无图标</strong><strong class="c"></strong></span>#end
            #if($!obj.mobileIcon)
            <div class="bigimgpre" id="clickLogoImg" style="display:none; left:380px;"><img src="$!obj.clickIcon"  width="50" height="50" /> </div>
            #end </li>
            <li>	图片尺寸  48*48</li>
        </ul>
        <ul class="set1" id="unClick_icon_acc_ul" >
          <li class="setcont_bg">未选中状态图标上传 </li>
          <li> <span class="size13" >
            <input name="textfield" type="text" id="textfield1" />
            </span> <span class="filebtn">
            <input name="button" type="button" id="button1" value=""/>
            </span> <span style="float:left;" class="file">
            <input name="unClickIconAcc" type="file" id="unClickIconAcc" class="file-text" size="30"/>
            </span> <span class="preview"> <img src="$!webPath/resources/style/system/manage/blue/images/preview.jpg" width="25" height="25"  id="unClickLogoShow" style="cursor:help"/> </span>#if(!$!obj.mobileIcon)<span id="nothis"><strong class="q"></strong><strong class="w">暂无图标</strong><strong class="c"></strong></span>#end
            #if($!obj.mobileIcon)
            <div class="bigimgpre" id="unClickLogoImg" style="display:none; left:380px;"><img src="$!obj.unClickIcon"  width="50" height="50" /> </div>
            #end </li>
            <li>	图片尺寸  48*48</li>
        </ul>
        </span>
        
        <ul class="set1" id="adv_type_ul">
          <li class="setcont_bg">广告类型</li>
          <li> <span>
            <input name="adv_type" id="adv_type1"  type="radio" #if($!adv_type==0 || !$!adv_type) checked="checked" #end value="0">
            <label for="adv_type1">系统广告</label>
            </input>
            <input name="adv_type" id="adv_type2"  type="radio" #if($!adv_type==1) checked="checked" #end value="1">
            <label for="adv_type2">自定义</label>
            </input>
            </span></li>
        </ul>
        <ul class="set1" id="gc_adv_0">
          <li  class="setcont_bg">系统广告</li>
          <li> <span>
            <select name="ap_id" id="ap_id">
              <option value="">请选择...</option>
              
              
		#foreach($ap in $!aps)
          
              
              <option value="$!ap.id">$!{ap.apTitle}</option>
              
              
		#end  
        
            
            </select>
            </span> <strong></strong></li>
        </ul>
        <ul class="set1" id="gc_adv_1" style="display:none" >
          <li class="setcont_bg">广告上传</li>
          <li> <span class="size13" >
            <input name="textfield" type="text" id="textfield1" />
            </span> <span class="filebtn">
            <input name="button" type="button" id="button1" value=""/>
            </span> <span style="float:left;" class="file">
            <input name="gc_adv" type="file" id="gc_adv" class="file-text" size="30"/>
            </span> <span class="preview"> <img src="$!webPath/resources/style/system/manage/blue/images/preview.jpg" width="25" height="25"  id="logoShow3" style="cursor:help"/> </span><span id="nothis"><strong class="q"></strong><strong class="w">为了能体现出弹出层广告效果，建议广告图片背景透明，宽度大于230px</strong><strong class="c"></strong></span> #if($!acc_img)
            <div class="bigimgpre" id="logoImg4" style="display:none; left:350px;"><img src="$!{acc_img}"  width="100" height="150"/> </div>
            #end </li>
        </ul>
         <ul class="set1" id="gc_adv_3" style="display:none">
          <li class="setcont_bg">广告链接</li>
          <li><span class="webname">
            <input name="gc_adv_url" type="text" id="gc_adv_url" value="$!acc_url" />
            </span><span id="nothis"><strong class="q"></strong><strong class="w">链接前请加http://，例如http://www.thinkervc.com</strong><strong class="c"></strong></span></li>
        </ul>
        <ul class="set1">
          <li class="setcont_bg">排序</li>
          <li><span class="webname">
            <input name="sequence" type="text" id="sequence" value="$!obj.sequence" />
            </span><span id="nothis"><strong class="q"></strong><strong class="w">序号越小，分类显示越靠前</strong><strong class="c"></strong></span></li>
        </ul>
      </div>
    </div>
    <input name="gbs_ids" id="gbs_ids" type="hidden"   />
  </form>
  <div class="submit"> <span class="pad120">
    <input name="save" type="button" value="提交" onclick="saveForm()" />
    </span> </div>
</div>
</body>
</html>